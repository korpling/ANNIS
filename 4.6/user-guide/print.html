<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ANNIS User Guide</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="installation/index.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation/desktop.html"><strong aria-hidden="true">2.1.</strong> Installing a Local Version (ANNIS Desktop)</a></li><li class="chapter-item expanded "><a href="installation/server.html"><strong aria-hidden="true">2.2.</strong> Installing an ANNIS Server</a></li><li class="chapter-item expanded "><a href="installation/migrate-annis3.html"><strong aria-hidden="true">2.3.</strong> Migrating from ANNIS 3</a></li></ol></li><li class="chapter-item expanded "><a href="interface/index.html"><strong aria-hidden="true">3.</strong> Using the ANNIS interface</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="interface/search-form.html"><strong aria-hidden="true">3.1.</strong> Search Form</a></li><li class="chapter-item expanded "><a href="interface/result-window.html"><strong aria-hidden="true">3.2.</strong> Result Window</a></li><li class="chapter-item expanded "><a href="interface/query-builder.html"><strong aria-hidden="true">3.3.</strong> Query Builder</a></li><li class="chapter-item expanded "><a href="interface/admin-web.html"><strong aria-hidden="true">3.4.</strong> Administration Interface</a></li></ol></li><li class="chapter-item expanded "><a href="aql/index.html"><strong aria-hidden="true">4.</strong> ANNIS Query Language (AQL)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="aql/word-forms.html"><strong aria-hidden="true">4.1.</strong> Searching for Word Forms</a></li><li class="chapter-item expanded "><a href="aql/annotations.html"><strong aria-hidden="true">4.2.</strong> Searching for Annotations</a></li><li class="chapter-item expanded "><a href="aql/regex.html"><strong aria-hidden="true">4.3.</strong> Searching using Regular Expressions</a></li><li class="chapter-item expanded "><a href="aql/trees.html"><strong aria-hidden="true">4.4.</strong> Searching for Trees</a></li><li class="chapter-item expanded "><a href="aql/pointing.html"><strong aria-hidden="true">4.5.</strong> Searching for Pointing Relations</a></li><li class="chapter-item expanded "><a href="aql/negation.html"><strong aria-hidden="true">4.6.</strong> Operator Negation</a></li><li class="chapter-item expanded "><a href="aql/export.html"><strong aria-hidden="true">4.7.</strong> Exporting Results</a></li><li class="chapter-item expanded "><a href="aql/frequency.html"><strong aria-hidden="true">4.8.</strong> Frequency Analysis</a></li><li class="chapter-item expanded "><a href="aql/operators.html"><strong aria-hidden="true">4.9.</strong> Complete List of Operators</a></li><li class="chapter-item expanded "><a href="aql/compatibility-mode.html"><strong aria-hidden="true">4.10.</strong> Differences in Compatibility Mode</a></li></ol></li><li class="chapter-item expanded "><a href="import-and-config/index.html"><strong aria-hidden="true">5.</strong> Importing and Configuring Corpora</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="import-and-config/convert.html"><strong aria-hidden="true">5.1.</strong> Converting Corpora for ANNIS using Pepper</a></li><li class="chapter-item expanded "><a href="import-and-config/import.html"><strong aria-hidden="true">5.2.</strong> Importing Corpora in the relANNIS or GraphML format</a></li><li class="chapter-item expanded "><a href="import-and-config/corpus-config.html"><strong aria-hidden="true">5.3.</strong> Configuring Settings for a Corpus</a></li><li class="chapter-item expanded "><a href="import-and-config/visualizations.html"><strong aria-hidden="true">5.4.</strong> Configuring Visualizations</a></li><li class="chapter-item expanded "><a href="import-and-config/visualizations-list.html"><strong aria-hidden="true">5.5.</strong> List of Visualizations</a></li><li class="chapter-item expanded "><a href="import-and-config/documentbrowser.html"><strong aria-hidden="true">5.6.</strong> Document Browser</a></li></ol></li><li class="chapter-item expanded "><a href="configuration/index.html"><strong aria-hidden="true">6.</strong> Configuration of ANNIS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="configuration/user.html"><strong aria-hidden="true">6.1.</strong> User Configuration on Server</a></li><li class="chapter-item expanded "><a href="configuration/instances.html"><strong aria-hidden="true">6.2.</strong> Multiple Instances of the Interface</a></li><li class="chapter-item expanded "><a href="configuration/rtl.html"><strong aria-hidden="true">6.3.</strong> Right-to-Left Visualizations</a></li></ol></li><li class="chapter-item expanded "><a href="advanced/index.html"><strong aria-hidden="true">7.</strong> Advanced Topics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="advanced/links-to-queries.html"><strong aria-hidden="true">7.1.</strong> Links to queries</a></li><li class="chapter-item expanded "><a href="advanced/embed-vis.html"><strong aria-hidden="true">7.2.</strong> Embed ANNIS visualizations</a></li><li class="chapter-item expanded "><a href="advanced/backend-frontend-separation.html"><strong aria-hidden="true">7.3.</strong> Install backend and front-end on different servers</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">ANNIS User Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>ANNIS is an open source, browser-based search and visualization architecture for
multi-layer corpora, developed at Humboldt-Universität zu Berlin, Georgetown
University and Potsdam University. It can be used to search for complex graph
structures of annotated nodes and edges forming a variety of linguistic structures, such as constituent or dependency syntax trees, coreference, rhetorical structure and parallel alignment edges, span annotations and associated multi-modal data (audio/video). </p>
<p><img src="images/annis3_full.png" alt="ANNIS user interface" /></p>
<p>This user guide provides an overview of the current ANNIS system, first steps for installing either a local instance or an ANNIS server with a demo corpus, as well as tutorials for converting data for ANNIS and running queries with AQL (ANNIS Query Language).</p>
<h1><a class="header" href="#installation" id="installation">Installation</a></h1>
<p>There are two editions of ANNIS, one for the local use on a standard computer (ANNIS Desktop) and one which is only needed when running a web-server. 
Both versions require the Installation of Java OpenJDK 11.
If your operating system does not already include Java, we recommend the installation of the open-source and free of charge installers provided at <a href="https://adoptium.net/">https://adoptium.net/</a>.</p>
<h1><a class="header" href="#installing-a-local-version-annis-desktop" id="installing-a-local-version-annis-desktop">Installing a Local Version (ANNIS Desktop)</a></h1>
<p>Local users who do not wish to make their corpora available online can install ANNIS 
Desktop under  most   versions   of  Linux,   Windows and  MacOS. 
To install ANNIS follow these steps:</p>
<ol>
<li>Download and the ANNIS Desktop JAR-file from the ANNIS website.</li>
<li>Double-click on downloaded JAR-file to start it. 
On Windows, at this point your Firewall may try to block ANNIS and offer you to unblock it — do so and ANNIS should start up.
If double clicking does not work, you might need to start ANNIS from a terminal.
Open your system terminal and navigate to the directory where the JAR-file is located, e.g. <code>/Users/myself/Documents</code> and directly start the JAR-file with java:
<pre><code class="language-bash">cd /Users/myself/Documents
java -jar annis-gui-&lt;version&gt;-desktop.jar
</code></pre>
You have to replace <code>&lt;version&gt;</code> with the version of ANNIS you are using.</li>
<li>A browser window with the address <a href="http://localhost:5712">http://localhost:5712</a> should open automatically, if not you can click on the button in the ANNIS Desktop window.</li>
</ol>
<h2><a class="header" href="#test-the-installation-is-working" id="test-the-installation-is-working">Test the installation is working</a></h2>
<ol>
<li>Download and the GUM demo corpus from the ANNIS website:
<a href="http://corpus-tools.org/annis/corpora.html">http://corpus-tools.org/annis/corpora.html</a>.</li>
<li>Click on the “Administration” button and select the “Import Corpus” tab.</li>
<li>Click on “Upload ZIP file with corpus“ and select the downloaded ZIP file</li>
<li>Once import is complete, click on the “Search interface” to get back to the search interface and test the corpus (click
on one of the example queries displayed on the screen, or try selecting the
GUM corpus, typing <code>pos=&quot;NN&quot;</code> in the AQL box at the top left and clicking
“Show Result”. See the sections <a href="installation/../interface">“Using the ANNIS interface”</a>and <a href="installation/../aql.html">“ANNIS Query Language (AQL)”</a> in this guide for some more example queries, or press the Tutorial button in the
Help/Examples tab of the interface for more information).</li>
</ol>
<h1><a class="header" href="#installing-an-annis-server" id="installing-an-annis-server">Installing an ANNIS Server</a></h1>
<p>The ANNIS server version can be installed  most   versions   of  Linux,   Windows and  MacOS but we will focus on Linux based servers in this documentation. 
To install the ANNIS server:</p>
<ol>
<li>Download and the ANNIS Server JAR-file from the ANNIS website. We assume you are saving it under <code>/usr/local/bin</code> but you can choose any other location.</li>
<li>Open your system terminal and execute the JAR-file:
<pre><code class="language-bash">/usr/local/bin/annis-gui-&lt;version&gt;-desktop.jar
</code></pre>
You have to replace <code>&lt;version&gt;</code> with the version of ANNIS you are using.</li>
</ol>
<p>This will start a REST service on port 5711 and the user interface on port 5712.
The user interface service will accept requests from all IPs and the embedded REST service only from <code>localhost</code>.
We recommend using a Nginx or Apache server as proxy for the user interface service for production to enable important features like HTTPS encryption.</p>
<h2><a class="header" href="#use-systemd-to-run-annis-as-a-service" id="use-systemd-to-run-annis-as-a-service">Use systemd to run ANNIS as a service</a></h2>
<p>You can create a simple systemd configuration file with the name <code>annis.service</code> and save it under one of the valid configuration folders, e.g. <code>/etc/systemd/system</code> to register ANNIS as a system service.</p>
<pre><code>[Unit]
Description=ANNIS corpus search and visualization

[Service]
Type=simple
ExecStart=/usr/local/bin/annis-gui-&lt;version&gt;-desktop.jar
Environment=&quot;&quot;
User=annis
Group=annis
WorkingDirectory=/usr/local

[Install]
WantedBy=multi-user.target
</code></pre>
<p>This configuration assumes that there is a “annis” user and group on the server.</p>
<p>You can permanently enable this service by calling</p>
<pre><code class="language-bash">$ systemctl enable annis.service
</code></pre>
<p>Since ANNIS is a Spring Boot application, the other methods of running a Spring Boot application as service (described in their <a href="https://docs.spring.io/spring-boot/docs/2.3.x/reference/html/deployment.html#deployment-service">documentation</a>) are also possible.</p>
<h1><a class="header" href="#migrating-from-annis-3" id="migrating-from-annis-3">Migrating from ANNIS 3</a></h1>
<p>These instructions are a guideline for upgrading the installation of ANNIS on a UNIX-like server. 
If you use the <a href="installation/desktop.html">ANNIS Desktop version</a> 
just download the new version and (re-) import the corpora you need.
Please read <a href="installation/server.html">the installation instructions</a> first if you
haven't done so yet.</p>
<p>It is currently not possible to migrate user accounts and groups automatically.
You should however be able to import all existing corpora in the relANNIS format and migrate the reference links.</p>
<h3><a class="header" href="#download-and-install-the-new-service" id="download-and-install-the-new-service">Download and install the new service</a></h3>
<p>Follow the <a href="installation/server.html">installation instructions</a> to get the new service running.
You should configure a new port for the ANNIS service if both old and new version run on the same server.
The old service must still be available while migrating the reference links (but not after).</p>
<h3><a class="header" href="#import-old-corpora" id="import-old-corpora">Import old corpora</a></h3>
<p>You should export a list of all existing corpora from the old service and use the new <a href="installation/../import-and-config/import.html#importing-a-corpus-using-the-command-line">ANNIS command line tool to import</a> them again.</p>
<p>This can take a long time, so if you use SSH you might want use a program like e.g. <a href="http://byobu.org/">Byobu</a> to start a terminal that continues to run process in the background even if the connection is interrupted.</p>
<h3><a class="header" href="#migrate-reference-links" id="migrate-reference-links">Migrate reference links</a></h3>
<p>ANNIS aims to be as backward-compatible as possible, but we need to make sure the reference links actually point not only to the same queries and corpora, but show exactly the same result <sup class="footnote-reference"><a href="#sameresult">1</a></sup>.</p>
<p>If you want to migrate the reference links, you have to export them as CSV files from ANNIS 3 using its command line interface.</p>
<pre><code class="language-.sh">annis-admin.sh dump url_shortener url_shortener.csv
</code></pre>
<p>You can select any output file in a location of your choice.</p>
<p>In the &quot;Administration&quot; user interface, there is a tab that allows to migrate reference links.
To do so, ANNIS will execute each query in the given CSV file both on the old ANNIS service and on the new one.
This is why you need to give the server URL and adminstration account information as parameters.</p>
<p><img src="installation/migrate-reference-urls.png" alt="Example configuration for the user interface to migrate reference links" /></p>
<p>After filling out all necessary information and clicking on &quot;Start migration&quot;, ANNIS will compare the results by executing the queries both on the old and the new ANNIS service.
If both results are exactly the same, it migrates the reference link to the new system.
The command will give a summary how many reference links have been migrated successfully and which kind of errors occurred on the other ones.
If you think a specific query triggers a bug in the new version of ANNIS, please check if there is already a bug report on <a href="https://github.com/korpling/ANNIS/issues">https://github.com/korpling/ANNIS/issues</a> or open a new one.</p>
<p>Some queries only work in the same way in <a href="installation/./aql-compatibility-mode.html">compatibility query mode</a>, these will be rewritten automatically.
The user will be able to execute this query normally, but sees a warning that its using deprecated functions of the query language.</p>
<p>For queries where both the normal and the compatibility mode don't return the same results, they are still migrated but a clear warning is shown to the user before execution, that this query is known to give different results compared to the previous version of ANNIS.</p>
<p><sup class="footnote-reference"><a href="#sameresult:">2</a></sup> Same result means, that the overall count is correct, that the matches have the same Salt IDs and that they are presented in the same order.</p>
<h1><a class="header" href="#using-the-annis-interface" id="using-the-annis-interface">Using the ANNIS interface</a></h1>
<p>The ANNIS interface is comprised of several areas, the most important of
which are the search form on the left side and the results tab on the right side.</p>
<p><img src="interface/annis3_interface.png" alt="Screenshot of the ANNIS user interface" /></p>
<h1><a class="header" href="#search-form" id="search-form">Search Form</a></h1>
<p><img src="interface/searchform.png" alt="ANNIS search form" /></p>
<p>The Search Form can be found on the left of the interface window. It's
bottom part shows the list of currently available corpora. By clicking
on the line with the corpus name, it is possible to select which corpora
should be searched in (hold down 'ctrl' to select multiple corpora
simultaneously). You may also configure groups of corpora or type in the
filter box to view subsets of the corpora.</p>
<p>The &quot;AQL&quot; field at the top of the form is used for inputting queries
manually (see the tutorials on the ANNIS Query Language from the ANNIS
website). As soon as one or several corpora are selected and a query is
entered or modified, the query will be validated automatically and
possible errors in the query syntax will be commented on in the
&quot;Status&quot; box below (which says &quot;valid query&quot; in the image above).</p>
<p>Once a valid query has been entered, pressing the &quot;Search&quot; button will
retrieve the number of matching positions and documents in the selected
corpora in the Status box and open the Result tab to display the first
set of matches.</p>
<p><img src="interface/searchoptions.png" alt="ANNIS search options" /></p>
<p>In order to get more control over the search you can click on &quot;Search
Options&quot; to unfold more detailed search options. The context
surrounding the matching expressions in the result list ist determined
by the &quot;Left Context&quot; and &quot;Right Context&quot; options and can be changed
on each side (by default up to 20 tokens). You can also configure how
many results are shown per page, what order results are shown in
(ascending, descending or random) and for some corpora, you can select
alternative segmentation layers to visualize data (relevant for
languages with multiple tokens per word form, etc., such as Arabic).
Entire texts can also be viewed using special document visualizations or
by clicking on the document icon next to each corpus name, if available.</p>
<p>The &quot;Query Language&quot; option allows to switch between the default AQL dialect 
and an <a href="interface/../aql-compatibility-mode.html">compatibility mode</a> emulating the behavior of the older ANNIS3.
Make sure to use the latest version for all new queries.</p>
<h1><a class="header" href="#result-window" id="result-window">Result Window</a></h1>
<p><img src="interface/search_bar.png" alt="ANNIS result window toolbar" /></p>
<p>The result window shows search results in pages of 10 hits each by
default (this can be changed in the Search Form). The toolbar at the top
of the window allows you to navigate between these pages. The &quot;Token
Annotations&quot; button on the toolbar allows you to toggle the token based
annotations, such as lemmas and parts-of-speech, on or off for you
convenience. You can use hyperlinks to your queries by copying the
current browser URL for e-mail or citation purposes, allowing others to
reproduce your query.</p>
<p>If your corpus contains multiple alternative text layers or
segmentations (e.g. normalized and un-normalized text), you may switch
between these on the fly by using the &quot;base text&quot; menu.</p>
<p><img src="interface/KWIC_narrow.png" alt="KWIC concordance in ANNIS" /></p>
<p>The result list itself initially shows a KWIC (key word in context)
concordance of matching positions in the selected corpora, with the
matching regions marked in color and the context in black on either
side. Colors in the result match the colors of search expressions in the
search box (red for the search item #1, purple for #2, etc.).</p>
<p>Context can be adjusted for individual search results up to the maximum
allowed for the current corpus. Token annotations are displayed in gray
under each token, and hovering over them with the mouse will show the
annotation name and namespace. More complex annotation levels can be
expanded, if available, by clicking on the plus icon next to the
level's name, e.g. dependencies and referent information for the
annotations in the dependency tree and grid views in the picture below.</p>
<p><img src="interface/annotation_levels.png" alt="visualization of different annotation levels" /></p>
<h1><a class="header" href="#query-builder" id="query-builder">Query Builder</a></h1>
<p>To open the graphical query builder, click on the <strong>Query Builder</strong>
button. On the left-hand side of the toolbar at the top of the query
builder canvans, you will see the <strong>Add Node</strong> button. Use this button
to define nodes to be searched for (tokens, non-terminal nodes or
annotations). Creating nodes and modifying them on the canvas will
immediately update the AQL field in the Search Form with your query,
though updating the query on the Search Form will not create a new graph
in the Query Builder.</p>
<p><img src="interface/query_builder_empty.png" alt="The Query Builder tab and the Create Node button" /></p>
<p>In each node you create you may click on <img src="interface/list-add.png" alt="The Add Node button" /> to specify an 
annotation value. The annotation name can be typed in or selected from a drop down list once a corpus is
selected. The operator field in the middle allows you to choose between
an exact match (the '=' symbol) or wildcard search using Regular
Expressions (the '~' symbol). The annotation value is given on the
right, and should <strong>NOT</strong> be surrounded by quotations (see the example
below). It is also possible to specify multiple annotations applying to
the same position by clicking on <img src="interface/list-add.png" alt="The Add Node button" />
multiple times. Clicking on <img src="interface/edit-clear.png" alt="The Clear all nodes button" />
will delete the values in the node. To search
for word forms, simply choose &quot;tok&quot; as the field name on the left. A
node with no data entered will match any node, that is an underspecified
token or non-terminal node or annotation.</p>
<p><img src="interface/node.png" alt="Query Builder node" /></p>
<p>To specify the relationship between nodes, first click on the &quot;Edge&quot;
link at the top left of one node, and then click the &quot;Dock&quot; link which
becomes available on the other nodes. An edge will connect the nodes
with an extra box from which operators may be selected (see below). For
operators allowing additional labels (e.g. the dominance operator <code>&gt;</code>
allows edge labels to be specified), you may type directly into the
edge's operator box, as in the example with a &quot;func&quot; label in the
image below. Note that the node clicked on first (where the &quot;Edge&quot;
button was clicked) will be the first node in the resulting quey, i.e.
if this is the first node it will dominate the second node (<code>#1 &gt; #2</code>)
and not the other way around, as also represented by the arrows along
the edge.</p>
<p><img src="interface/edge.png" alt="Connecting nodes with an edge" /></p>
<h1><a class="header" href="#administration-interface" id="administration-interface">Administration Interface</a></h1>
<p>The administration interface allows you to import and delete corpora, as well as to
define users from the ANNIS web application directly. To log into the administration
interface, use the URL of you ANNIS web application and add /admin or press the Administration button next to ‘About ANNIS’ (this button is only
shown if you are a logged in administrator or when using the desktop version). You should see the screen below:</p>
<p><img src="interface/web-admin-import.png" alt="import in web-adminstration interface" /></p>
<p>Here you can upload a zipped relANNIS corpus for import and set the e-mail address
in the configuration file. The corpus management tab allows you to select corpora for
deletion:</p>
<p><img src="interface/web-admin-corpus-select.png" alt="select corpora for deletion" /></p>
<p>And finally the user and group management tabs allow you to add or remove users,
give them special permissions, and determine which groups can see which corpora.</p>
<p><img src="interface/web-admin-groups.png" alt="group management" /></p>
<p><img src="interface/web-admin-users.png" alt="user management" /></p>
<p>These functions edit the files described in the <a href="interface/../configuration/user.html">User Configuration on Server section</a>.</p>
<h1><a class="header" href="#annis-query-language-aql" id="annis-query-language-aql">ANNIS Query Language (AQL)</a></h1>
<p>ANNIS comes with its own query language called ANNIS Query Language (AQL).
AQL is based on the concept of searching for annotation attributes and relations between them.</p>
<p>A search is formulated by defining each token, non-terminal node or annotation being searched for as an element. An element can be a token (simply text between quotes: <code>&quot;dogs&quot;</code> or else <code>tok=&quot;dogs&quot;</code>) or an attribute-value pair (such as <code>tok=&quot;dogs&quot;</code>, or optionally with a namespace: <code>tiger:cat=&quot;PP&quot;</code>). Note that different corpora can have completely different annotation names and values - these are not specified by ANNIS. Underspecified tokens or nodes in general may be specified using <code>tok</code> and <code>node</code> respectively.</p>
<p>Once all elements are declared, relations between the elements (or edges) are specified which must hold between them. The elements are referred back to serially using variable numbers, and linguistic operators bind them together, e.g. <code>#1 &gt; #2</code> meaning the first element dominates the second in a tree or graph. 
Operators define the possible overlap and adjacency relations between annotation spans, as well as recursive hierarchical relations between nodes. Some operators also allow specific labes to be specified in addition to the operator (see the <a href="aql/operators.html">operator list</a>). </p>
<h1><a class="header" href="#searching-for-word-forms" id="searching-for-word-forms">Searching for Word Forms</a></h1>
<p>To search for word forms in ANNIS, simply select a corpus (in this
example the freely available <a href="https://corpling.uis.georgetown.edu/gum/">GUM corpus</a>) and enter a search string
between double quotation marks, e.g.:</p>
<pre><code>&quot;do&quot;
</code></pre>
<p>Note that the search is <strong>case sensitive</strong>, so it will not find cases of
capitalized 'Do', for example at the beginning of a sentence. In order
to find both options, you can either look for one form OR the other
using the pipe sign ( <code>|</code> ):</p>
<pre><code>&quot;do&quot; | &quot;Do&quot;
</code></pre>
<p>or else you can use <a href="aql/aql-regex.html">regular expressions</a>, which must
be surrounded by slashes ( <code>/</code> ) instead of quotation marks:</p>
<pre><code>/[Dd]o/
</code></pre>
<p>To look for a sequence of multiple word forms, enter your search terms
separated by <code>&amp;</code> and then specify that the relation between the elements
is one of <strong>precedence</strong>, as signified by the period ( <strong><code>.</code></strong> )
operator:</p>
<pre><code>&quot;do&quot; &amp; &quot;n't&quot; &amp; #1 . #2
</code></pre>
<p>The expression <code>#1 . #2</code> signifies that the first element (&quot;do&quot;)
precedes the second element (&quot;n't&quot;). Alternatively, you can also place
the operator directly between the search elements as a <strong>shortcut</strong>. The
following shortcut query is equivalent to the one above:</p>
<pre><code>&quot;do&quot; . &quot;n't&quot;`
</code></pre>
<p>For <strong>indirect precedence</strong> (where other tokens may stand between the
search terms), use the <strong><code>.*</code></strong> operator:</p>
<pre><code>/[Dd]o/ &amp; &quot;n't&quot; &amp; &quot;any&quot; &amp; #1 . #2 &amp; #2 .* #3 
</code></pre>
<p><strong>OR using shortcuts:</strong></p>
<pre><code>/[Dd]o/ . &quot;n't&quot; .* &quot;any&quot;
</code></pre>
<p>The queries above find sequences beginning with the token &quot;Do&quot; or &quot;do&quot;,
followed directly by &quot;n't&quot;, which must be followed either directly or
indirectly (.*) by &quot;any&quot;. A range of allowed distances can also be
specified numerically as follows:</p>
<pre><code>/[Nn]ot/ &amp; &quot;all&quot; &amp; #1 .1,5 #2
</code></pre>
<p><strong>OR:</strong></p>
<pre><code>/[Nn]ot/ .1,5 &quot;all&quot;
</code></pre>
<p>Meaning the two words &quot;not&quot; and &quot;all&quot; may appear at a distance of 1 to 5
tokens. The operator <code>.*</code> allows a distance of up to 50 tokens by
default, so searching with <code>.1,50</code> is the same as using <code>.*</code> instead.
Greater distances (e.g. <code>.1,100</code> for 'within 100 tokens') should always
be specified explicitly.</p>
<p>Finally, we can add metadata restrictions to the query, which filter out
documents not matching our definitions. Metadata attributes must be connected to
other non-meta attributes with the <code>@*</code> (part-of) operator:</p>
<pre><code>&quot;want&quot; &amp; &quot;to&quot; &amp; #1 .1,5 #2
&amp; type=&quot;interview&quot; &amp; #1 @* #2 
</code></pre>
<p>To view metadata for a search result or for a corpus, press the &quot;i&quot; icon
next to it in the result window or in the search form respectively.</p>
<h1><a class="header" href="#searching-for-annotations" id="searching-for-annotations">Searching for Annotations</a></h1>
<p>Annotations may be searched for using an annotation name and value. The
names of the annotations vary from corpus to corpus, though many corpora
contain part-of-speech and lemma annotations with the names <code>pos</code> and
<code>lemma</code> respectively (annotation names are <strong>case sensitive</strong>). For
example, to search for all forms of the verb <em>be</em> in the GUM corpus,
simply select the GUM corpus and enter:</p>
<pre><code>lemma=&quot;be&quot;
</code></pre>
<p>Negative searches are also possible using <code>!=</code> instead of <code>=</code>. For negated
tokens (word forms) use the reserved attribute tok. For example:</p>
<pre><code>lemma!=&quot;be&quot;
</code></pre>
<p>or:</p>
<pre><code>tok!=&quot;be&quot; 
</code></pre>
<p>Metadata attributes can also be negated:</p>
<pre><code>lemma=&quot;be&quot; @* type!=&quot;interview&quot;
</code></pre>
<p>To only find finite forms of a verb in GUM, use the part-of-speech (pos)
annotation concurrently with lemma, and specify that both the lemma and
pos should apply to the same element. For example for inflected forms of
the verb <em>give</em>:</p>
<pre><code>lemma=&quot;give&quot; &amp; pos=/VV.+/ &amp; #1 _=_ #2
</code></pre>
<p>OR (using a shortcut):</p>
<pre><code>lemma=&quot;give&quot; _=_ pos=/VV.+/
</code></pre>
<p>The regular expression <code>/VV.+/</code> means a part of speach that begins with
VV (verb), but has additional characters (.+), such as for past tense
(VVD) or gerund (VVG). The expression <code>#1 _=_ #2</code> uses the span identity
operator to specify that the first annotation and the second annotation
apply to exactly the same position in the corpus.</p>
<p>Annotations can also apply to longer spans than a single token: for
example, in GUM, the annotation <code>entity</code> signifies the entity type of a
discourse referent. This annotation can also apply to phrases longer
than one token. The following query finds spans containing a discourse
referent who is a person:</p>
<pre><code>entity=&quot;person&quot;
</code></pre>
<p>If the corpus contains more than one annotation type named <code>entity</code>, a
namespace may be added to disambiguate these annotations (for example,
the entity annotation in the GUM corpus has the namespace <code>ref:</code>, so we
can search for <code>ref:entity=&quot;person&quot;</code>). The namespace may always be
dropped, but if there are multiple annotations with the same name but
different namespaces, dropping the namespace will find all of those
annotations. If you drop the value of the annotation, you can also
search for any corpus positions that have that annotation, without
constraining the value. For example, the following query finds all
annotated entities in the GUM corpus, whether or not they are a person:</p>
<pre><code>entity
</code></pre>
<p>In order to view the span of tokens to which the entity annotation
applies, enter the query and click on &quot;Search&quot;, then open the
<em>referents</em> layer to view the grid containing the span.</p>
<p>Further operators can test the relationships between potentially
overlapping annotations in spans. For example, the operator <code>_i_</code>
examines whether one annotation fully contains the span of another
annotation (the <em>i</em> stands for 'includes'):</p>
<pre><code>head &amp; infstat=&quot;new&quot; &amp; #1 _i_ #2
</code></pre>
<p>OR (using a shortcut):</p>
<pre><code>head _i_ infstat=&quot;new&quot;
</code></pre>
<p>This query finds information structurally new discourse referents
(<code>infstat=&quot;new&quot;</code>) contained within headings (<code>head</code>).</p>
<h1><a class="header" href="#searching-using-regular-expressions" id="searching-using-regular-expressions">Searching using Regular Expressions</a></h1>
<p>When searching for word forms and annotation values, it is possible to
employ wildcards as placeholders for a variety of characters, using
Regular Expression syntax (see e.g.
<a href="http://www.regular-expressions.info/">http://www.regular-expressions.info/</a> for detailed information).<sup class="footnote-reference"><a href="#regex-engine">1</a></sup>
To search for wildcards use slashes instead of quotation marks to
surround your search term. For example, you can use the <strong>period (<code>.</code>)</strong>
to replace any single character:</p>
<pre><code>tok=/ca./
</code></pre>
<p>This finds word forms such as &quot;cat&quot;, &quot;can&quot;, &quot;car&quot;, &quot;cap&quot; etc. It is also
possible to make characters optional by following them with a <strong>question
mark (<code>?</code>)</strong>. The following example finds cases of &quot;car&quot; and &quot;cart&quot;,
since the &quot;t&quot; is optional:</p>
<pre><code>tok=/cart?/
</code></pre>
<p>It is also possible to specify an arbitrary number of repetitions, with
an <strong>asterisk (<code>*</code>)</strong> signifying zero or more occurrences and a <strong>plus
(<code>+</code>)</strong> signifying at least one occurrence. For example, the first query
below finds &quot;o&quot;, &quot;of&quot;, and &quot;off&quot; (since the asterisk means zero or more
times the preceding &quot;f&quot;), while the second finds &quot;of&quot; and &quot;off&quot;, since
at least one &quot;f&quot; must be found:</p>
<pre><code>tok=/of*/
</code></pre>
<pre><code>tok=/of+/
</code></pre>
<p>It is possible to combine these operators with the period operator to
mean any number of occurrences of an arbitrary character. For example,
the query below searches for pos (part-of-speech) annotations that begin
with &quot;VV&quot;, corresponding to all forms of lexical verbs (the auxiliaries
&quot;be&quot; and &quot;have&quot; are tagged VB... and VH... respectively). The string
&quot;VV&quot; means that the result must begin with &quot;VV&quot;, the period stands for
any character, and the asterisk means that 'any character' can be
repeated zero or more time, as above.</p>
<pre><code>pos=/VV.*/
</code></pre>
<p>This finds both finite verbs (&quot;VVZ&quot;, &quot;VVP&quot;, &quot;VVD&quot;) and non-finite ones
(&quot;VV&quot;) or gerunds (&quot;VVG&quot;). It is also possible to search for explicit
alternatives by either specifying characters in <strong>square brackets</strong> or
longer strings in <strong>round brackets separated by pipe symbols</strong>. The
first example below finds either &quot;of&quot; or &quot;on&quot; (i.e. &quot;o&quot; followed by
either &quot;f&quot; or &quot;n&quot;) while the second example finds lemma annotations that
are either &quot;be&quot; or &quot;have&quot;.</p>
<pre><code>tok=/o[nf]/
</code></pre>
<pre><code>lemma=/(be|have)/
</code></pre>
<p>Finally, negative searches can be used as usual with the exclamation
point, and regular expressions can generally be used also in edge
annotations. For example, if we search for trees (see also <a href="aql/aql-trees.html">Searching
for Trees</a>) where a lexical verb dominates another
token with a dependency edge not containing 'obj', we can use a wildcard
to rule out all edges labels containing those letters. This will give us
all non-object dependants of lexical verbs:</p>
<pre><code>pos=/VV.*/ &amp; tok &amp; #1 -&gt;dep[func!=/.*obj.*/] #2
</code></pre>
<p>OR (using a shortcut):</p>
<pre><code>pos=/VV.*/ -&gt;dep[func!=/.*obj.*/] tok
</code></pre>
<div class="footnote-definition" id="regex-engine"><sup class="footnote-definition-label">1</sup>
<p>While there is the POSIX-standard for regular expressions, different search engines might use slightly different syntax and support different types of search constraints, e.g. when searching for Unicode characters.
ANNIS used to rely on the <a href="https://www.postgresql.org/docs/9.4/functions-matching.html">PostgreSQL regular expression implementation</a> but now uses the Rust library <code>regex</code>. See <a href="https://docs.rs/regex#syntax">https://docs.rs/regex#syntax</a> for the currently supported regular expresssion syntax, as provided by this library.</p>
</div>
<h1><a class="header" href="#searching-for-trees" id="searching-for-trees">Searching for Trees</a></h1>
<p>In corpora containing hierarchical structures, annotations such as
syntax trees can be searched for by defining terminal or none-terminal
node annotations, functional dependencies and their values (for
dependencies see see <a href="aql/aql-pointing.html">Searching for Pointing
Relations</a>). A simple search for
prepostional phrases in the GUM corpus looks like this:</p>
<pre><code>const:cat=&quot;PP&quot;
</code></pre>
<p>If the corpus contains no more than one annotation called <code>cat</code>, the
optional namespace, in this case <code>const:</code>, may be dropped. This finds
all PP nodes in the corpus. You can also search for the NP being
dominated by the PP like this:</p>
<pre><code>cat=&quot;PP&quot; &amp; cat=&quot;NP&quot; &amp; #1 &gt; #2
</code></pre>
<p>OR (using a shortcut):</p>
<pre><code>cat=&quot;PP&quot; &gt; cat=&quot;NP&quot;
</code></pre>
<p>To find all PP nodes directly dominating an adverb, you can combine a
search for syntactic category and part-of-speech (pos) values (in this
case &quot;RB&quot; for adverb). The query below gives the shortcut form:</p>
<pre><code>cat=&quot;PP&quot; &gt; pos=&quot;RB&quot;
</code></pre>
<p>The operator <strong>&gt;</strong> signifies <strong>direct dominance</strong>, which must hold
between the first and the second element. Once the Query Result tab is
shown you may open the &quot;constituents&quot; annotation layer to see the
corresponding tree.</p>
<p><img src="aql/../images/tree_expanded.png" alt="" /></p>
<p>Note that since the context is set to a number of tokens left and right
of the search term, the tree for the whole sentence may not be
retrieved, though you can change the amount of tokens at the top of each
search result, or for all search results in the Search Options tab. To
make sure that the whole clause is always included, you may want to
specifically search for the clause or sentence dominating the PP. To do
so, specify the sentence in another element and use the <strong>indirect
dominance</strong> ( <strong>&gt;*</strong> ) operator:</p>
<pre><code>cat=&quot;ROOT&quot; &gt;* cat=&quot;PP&quot; &gt; pos=&quot;RB&quot;
</code></pre>
<p>If the annotations in the corpus support it, you may also look for edge
labels. Using the following query will find all adverbial modifier NPs,
dominated by some node through an edge labeled ADV. Since we do not know
anything about the modified node, we simply use the <code>node</code> element as a
place holder. This element can match any node or annotation in the
graph:</p>
<pre><code>node &gt;[const:func=&quot;ADV&quot;] cat=&quot;NP&quot;
</code></pre>
<p>Again, the namespace <code>const:</code> is optional and only important if there
are multiple 'func' annotations. It is also possible to negate the label
of the dominance edge as in the following query:</p>
<pre><code>cat &gt;[func!=&quot;TMP&quot;] cat
</code></pre>
<p>which finds all syntactic categories (value unspecified) dominating
another syntactic category with a label other than &quot;TMP&quot;.</p>
<h1><a class="header" href="#searching-for-pointing-relations" id="searching-for-pointing-relations">Searching for Pointing Relations</a></h1>
<p>Pointing relations are used to express an arbitrary directed
relationship between two elements (terminals or non-terminals) without
implying dominance or coverage inheritance. For instance, in the GUM
corpus, elements in the <code>ref:</code> namespace may point to each other to
express coreference or anaphoric relations. The following query searches
for two <code>entity</code> annotations, which specify whether a discourse referent
is a person, or an animal, a location, an object, an abstract etc.</p>
<pre><code>entity=&quot;person&quot; &amp; entity!=&quot;person&quot; &amp; #1 -&gt;coref #2
</code></pre>
<p>Using the pointing relation operator <code>-&gt;</code> with the type <code>coref</code>, the
first <code>entity</code>, which should be a person, is said to be coreferent with
its antecedent, the second entity, which is not a person. In practice,
this will usually occur due to &quot;bridging&quot;, where something like a whole
(e.g. an organization such as a 'research team') implies the existence
of its part (e.g. persons, such as 'the scientists'). To see a
visualization of the coreference relations, open the coreference
annotation layer in the GUM corpus. In the image below, one of the
matches for the above query is highlighted in red (die Seeburger und
einige Groß-Glienicker ... sie 'the Seeburgers and some
Groß-Glienickers... they'). Other discourse referents in the text
(marked with an underline) may be clicked on, causing coreferential
chains containing them to be highlighted as well. Note that discourse
referents may overlap, leading to multiple underlines: Die Seeburger
'the Seeburgers' is a shorter discourse referent overlapping with the
larger one ('the Seeburgers and some Groß-Glienickers'), and each
referent has its own underline. Annotations of the coreference edges of
each relation can be viewed by hovering of the appropriate underline.</p>
<p><img src="aql/../images/coref.png" alt="" /></p>
<p>The pointing relation operator can also search for longer chains of
coreference, using the asterisk extension shown below:</p>
<pre><code>entity=&quot;organization&quot; -&gt;coref* entity=&quot;person&quot;
</code></pre>
<p>This finds all organizations that point back to a person at any point
along the preceding coreference chain. It is also possible to specify
annotations of pointing relations, which for coreference in the GUM
corpus mark what kind of coreference is used: anaphoric, cataphoric,
lexical coreference, apposition, or bridging. To find appositions of
place entities, use the following query:</p>
<pre><code>entity=&quot;place&quot; -&gt;coref[type=&quot;appos&quot;] entity=&quot;place&quot;
</code></pre>
<p>Another way to use pointing relations is found in syntactic dependency
trees. The queries in this case can use both pointing relation types and
annotations too, as in the following query:</p>
<pre><code>pos=/VV[PZ]/ &amp; tok &amp; #1 -&gt;dep[func=&quot;dobj&quot;] #2
</code></pre>
<p>OR (using a shortcut):</p>
<pre><code>pos=/VV[PZ]/ -&gt;dep[func=&quot;dobj&quot;] tok
</code></pre>
<p>This query searches for a present tense lexical verb (with the
part-of-speech VVZ or VVP) and a token, with a pointing relation of the
type 'dep' (for dependency) between the two, annotated with
<code>func=&quot;dobj&quot;</code> (the function 'direct object'). The result can be viewed
with the arch dependency visualizer, which shows the verb 'shows' and
its object 'location'.</p>
<p><img src="aql/../images/dep_vis.png" alt="" /></p>
<h1><a class="header" href="#operator-negation" id="operator-negation">Operator Negation</a></h1>
<h2><a class="header" href="#negation-with-assumption-that-all-annotations-exists" id="negation-with-assumption-that-all-annotations-exists">Negation with assumption that all annotations exists</a></h2>
<p>Sometimes, you need to find instances in a corpus where a relation is not true between to annotations.
For example, you can search for sentences with a noun and a verb like this:</p>
<pre><code>cat=&quot;ROOT&quot;
&amp; pos=/N.*/ . pos=/V.*/ 
&amp; #1 &gt;* #2 &amp; #1 &gt;* #3
</code></pre>
<p>We search for three nodes: the root node, a noun and a verb, and specify that both nodes should be dominated by the root node.
If we now want to get all the instances, where both nodes form a conjunction, we could add another constraint on the noun and verb node using a dependency relation.</p>
<pre><code>cat=&quot;ROOT&quot;
&amp; pos=/N.*/ . pos=/V.*/ 
&amp; #1 &gt;* #2 &amp; #1 &gt;* #3
&amp; #2 -&gt;dep[func=&quot;conj&quot;] #3
</code></pre>
<p>If we instead want to get all instances where there is <strong>no such dependency relation between the two nodes</strong>, we can use the negated operator <code>!-&gt;</code>.</p>
<pre><code>cat=&quot;ROOT&quot;
&amp; pos=/N.*/ . pos=/V.*/ 
&amp; #1 &gt;* #2 &amp; #1 &gt;* #3
&amp; #2 !-&gt;dep[func=&quot;conj&quot;] #3
</code></pre>
<p>We can negate all binary operators by adding the <code>!</code> prefix to them.
Per default, these operators only act as a filter mechanism, the annotations they refer to still have to exist and have to be bound by other non-negated operators.
In our example, both tokens (the noun defined by <code>pos/N.*/</code> and the verb defined by <code>pos=/V.*/</code>) have to exist.</p>
<h2><a class="header" href="#negation-without-the-assumption-of-existence" id="negation-without-the-assumption-of-existence">Negation without the assumption of existence</a></h2>
<p>If we want to allow that e.g. the verb might not exist, we have to mark it as <strong>optional</strong> in the AQL query by adding a <code>?</code> after the annotation definition (<code>pos=/V.*/</code> becomes <code>pos=/V.*/?</code>).
For example, to search for root segments without any verb, we can combine the negated dominance operator with an optional verb:</p>
<pre><code>cat=&quot;ROOT&quot; !&gt;* pos=/V.*/?
</code></pre>
<p>Since optional annotations might not exist, they are not part of the match result, and they are also not highlighted.</p>
<p>Negated operators must have at least one operand which is non-optional, so </p>
<pre><code>pos=&quot;DT&quot;? &amp; &quot;amazing&quot; &amp; #1 !. #2
</code></pre>
<p>is fine and finds all occurrences of &quot;amazing&quot; without a determiner before it (even if &quot;amazing&quot; is at the beginning of the text), but <code>pos=&quot;DT&quot;? &amp; &quot;amazing&quot;? &amp; #1 !. #2</code> would be invalid because both operands are optional.
Also, you can only use optional operands for negated operators.</p>
<h1><a class="header" href="#exporting-results" id="exporting-results">Exporting Results</a></h1>
<p>To export search results, open the menu &quot;More&quot; between the Search and
History buttons and select &quot;Export&quot;:</p>
<p><img src="aql/../images/export.png" alt="" /></p>
<p>Enter the query whose results you want to export as usual in the AQL
box. Note that you <strong>do not need to carry out the query first</strong>. You can
enter the query and export without pressing Search before. Several
exporter modules can be selected from the Export tab shown below.</p>
<p><img src="aql/../images/export2.png" alt="" /></p>
<p>The <strong>SimpleTextExporter</strong> simply gives the text for all tokens in each
search result, including context, in a one-row-per-hit format. The
tokens covered by the match area are marked with square brackets and the
results are numbered, as in the following
example:</p>
<pre><code>    0. of the International Brotherhood of [Magicians] Wednesday , October 9 , 
    1. Magic Month in the United [States] . Wikinews spoke with William 
    2. of the International Brotherhood of [Magicians] , about the current state 
    3. - &quot; Scarne on Card [Tricks] &quot; and &quot; Scarne on 
    4. and &quot; Scarne on Magic [Tricks] &quot; . That started me 
</code></pre>
<p>The <strong>TokenExporter</strong> adds all annotations of each token separated by slashes
(e.g. dogs/NNS/dog for a token dogs annotated with a part-of-speech NNS
and a lemma dog).</p>
<p>The <strong>GridExporter</strong> adds all annotations available for the span of
retrieved tokens, with each annotation layer in a separate line.
Annotations are separated by spaces and the hierarchical order of
annotations is lost, though the span of tokens covered by each
annotation may optionally be given in square brackets (to turn this off
use the optional parameter <code>numbers=false</code> in the ‘Parameters’ box). The
user can specify annotation layers to be exported in the additional
‘Annotation Keys’ box, and annotation names should be separated by
comas, as in the image above. Metadata annotations can also be exported
by entering “metakeys=” and a list of comma separated metadata names in
the Parameters box. If nothing is specified, all available annotations
and no metadata will be exported. Multiple options are separated by a
semicolon, e.g. the Parameters <code>metakeys=type,docname;numbers=false</code>. An
example output with token numbers and the part of speech (pos) and
syntactic category annotations looks as follows.</p>
<pre><code>0.   tok  of the International Brotherhood of Magicians Wednesday 
    pos  IN[1-1] DT[2-2] NP[3-3] NP[4-4] IN[5-5] NPS[6-6] NP[7-7] 
    cat  S[1-6] VP[1-6] NP[1-6] PP[1-6] NP[2-4] PP[5-6] NP[6-6] NP[7-12] 
</code></pre>
<p>Meaning that the annotation cat=&quot;NP&quot; applies to tokens 1-6 in the search
result, and so on. Note that when specifying annotation layers, if the
reserved name 'tok' is not specified, the tokens themselves will not be
exported (annotations only).</p>
<p>The <strong>CSVExporter</strong> outputs the format usable by spreadsheet programs such as Excel or Calc.
It is also easy to read CSV files in R- or Python-Scripts.
Only the attributes of the search elements (#1, #2 etc. in AQL) are outputted, and are separated
by tabs. The order and name of the attributes is declared in the first line of the export text, as in this example:</p>
<pre><code>1_id	1_span	1_anno_const::cat	2_id	2_span	2_anno_GUM::claws5	2_anno_GUM::lemma	2_anno_GUM::penn_pos	2_anno_GUM::pos	2_anno_GUM::tok_func
salt:/GUM/GUM_interview_ants#const_0_39	thee amazingg adaptations	NP	salt:/GUM/GUM_interview_ants#tok_40	amazing	AJ0	amazing	JJ	JJ	amod
salt:/GUM/GUM_interview_ants#const_0_42	sociall insects	NP	salt:/GUM/GUM_interview_ants#tok_42	social	AJ0	social	JJ	JJ	amod
salt:/GUM/GUM_interview_ants#const_0_50	thee extremee parasitee pressure	NP	salt:/GUM/GUM_interview_ants#tok_51	extreme	AJ0	extreme	JJ	JJ	amod
</code></pre>
<p>The export shows the properties of an NP node dominating a token with
the part-of-speech JJ. Since the token also has other attributes, such
as the lemma and part of speech tags, these are also retrieved.</p>
<p>It is also possible to output metadata annotations per hit using the
CSVExporter. To do so, use the parameter metakeys=meta1,meta2 etc. For
example, if your documents have a metadata annotation called 'genre',
you may export it for each search result as a further column using
metakeys=genre in the parameters box.</p>
<p>Most of these exporters do not work well when the corpus uses <em>multiple segmentations</em>, like in dialogues.
If they extract the spanned text for a match, they might have no way of automatically knowing which segmentation is the right one and display an empty span.
For the CSVExporter, you can set the <code>segmentation</code> parameter (e.g. <code>segmentation=dipl</code>) to the name of the segmentation, and it will be used as source for the spanned text.</p>
<p>Note that exporting may be slow if the result set is large.</p>
<h1><a class="header" href="#frequency-analysis" id="frequency-analysis">Frequency Analysis</a></h1>
<p>To perform a frequency analysis, enter the query whose results you want
to analyze as usual in the AQL box. Note that you <strong>do not need to carry
out the query first</strong>. Next, open the menu “More” between the Search and
History buttons and select “Frequency Analysis”:</p>
<p><img src="aql/../images/export.png" alt="" /></p>
<p>The interface will open the frequency analysis tab shown below.
Initially, rows will be generated for the nodes present in the query.
For example, two rows are automatically generated for the following
query, which finds any pair of consecutive tokens:</p>
<pre><code>tok . tok
</code></pre>
<p><img src="aql/../images/freq.png" alt="" /></p>
<p>Clicking on “Perform frequency analysis” will produce a
breakdown of all consecutive token bigrams in the corpus. The frequency
graph will only show the first 500 elements, but the table below it will
give the entire list of values, which can also be <strong>exported as a CSV
file</strong>.</p>
<p><img src="aql/../images/freq2.png" alt="" /></p>
<p>To edit the analysis or analyze a new query, click the <strong>New Analysis</strong>
button. It is also possible to <strong>add annotations</strong> to the analysis that
were not in the original query, provided that these are expected to
belong to some other node in the query. For example, the tokens in the
GUM corpus also have part-of-speech and lemma information. We can
replace the lines in the analysis specifying that tok values should be
counted with pos values, which gives us part-of-speech bigrams. We can
also add a lemma annotation belonging to the first search element, by
clicking the Add button and entering the node definition number and
annotation name we are interested in:</p>
<p><img src="aql/../images/freq3.png" alt="" /></p>
<p>As a result, we will get a count for each combination of values grouped
by the first and second tokens' parts-of-speech, as well as the first
token's lemma.</p>
<h1><a class="header" href="#complete-list-of-operators" id="complete-list-of-operators">Complete List of Operators</a></h1>
<p>AQL currently includes the following operators:</p>
<table><thead><tr><th align="center">Operator</th><th align="left">Description</th><th align="center">Illustration</th><th align="left">Notes</th><th></th></tr></thead><tbody>
<tr><td align="center"><code>.</code></td><td align="left">direct precedence</td><td align="center"><img src="aql/../images/A-pred-B.svg" alt="" /></td><td align="left">For non-terminal nodes, precedence is determined by the right-most and left-most terminal children. In corpora with multiple segmentations the layer on which consecutivity holds may be specified with <code>.layer</code></td><td></td></tr>
<tr><td align="center"><code>.*</code></td><td align="left">indirect precedence</td><td align="center"><img src="aql/../images/A-pred-ind-B.svg" alt="" /></td><td align="left">For specific sizes of precedence spans, <code>.n,m</code> can be used, e.g. <code>.3,4</code> - between 3 and 4 token distance; the default maximum distance for <code>.*</code> is 50 tokens. As above, segmentation layers may be specified, e.g. <code>.layer,3,4</code></td><td></td></tr>
<tr><td align="center"><code>^</code></td><td align="left">directly near</td><td align="center"><img src="aql/../images/A-pred-B.svg" alt="" /> or <img src="aql/../images/B-pred-A.svg" alt="" /></td><td align="left">Same as precedence, but in either order. In corpora with multiple segmentations the layer on which consecutivity holds may be specified with <code>^layer</code></td><td></td></tr>
<tr><td align="center"><code>^*</code></td><td align="left">indirectly near</td><td align="center"><img src="aql/../images/A-pred-ind-B.svg" alt="" /> or <img src="aql/../images/B-pred-ind-A.svg" alt="" /></td><td align="left">Like indirect precedence in either order. The form <code>^n,m</code> can be used, e.g. <code>^3,4</code> - between 3 and 4 token distance; the default maximum distance for <code>^*</code> is 50 tokens. As above, segmentation layers may be specified, e.g. <code>^layer,3,4</code></td><td></td></tr>
<tr><td align="center"><code>&gt;</code></td><td align="left">direct dominance</td><td align="center"><img src="aql/../images/A-dom-B.svg" alt="" /></td><td align="left">A specific edge type may be specified, e.g. <code>&gt;secedge</code> to find secondary edges. Edge labels are specified in brackets, e.g. <code>&gt;[func=&quot;OA&quot;]</code> for an edge with the function 'object, accusative'</td><td></td></tr>
<tr><td align="center"><code>&gt;*</code></td><td align="left">indirect dominance</td><td align="center"><img src="aql/../images/A-dom-ind-B.svg" alt="" /></td><td align="left">For specific distance of dominance, <code>&gt;n,m</code> can be used, e.g. <code>&gt;3,4</code> - dominates with 3 to 4 edges distance</td><td></td></tr>
<tr><td align="center"><code>@*</code></td><td align="left">part of sub-corpus</td><td align="center"></td><td align="left">Left attribute is part of a sub-corpus having the attribute of the right-hand side. For specific distance range in the sub-corpus hierarchy, <code>@n,m</code> can be used.</td><td></td></tr>
<tr><td align="center"><code>_=_</code></td><td align="left">identical coverage</td><td align="center"><img src="aql/../images/A-cov-ident-B.svg" alt="" /></td><td align="left">Applies when two annotations cover the exact same span of tokens</td><td></td></tr>
<tr><td align="center"><code>_i_</code></td><td align="left">inclusion</td><td align="center"><img src="aql/../images/A-cov-incl-B.svg" alt="" /></td><td align="left">Applies when one annotation covers a span identical to or larger than  another</td><td></td></tr>
<tr><td align="center"><code>_o_</code></td><td align="left">overlap</td><td align="center"><img src="aql/../images/A-cov-over-B.svg" alt="" /></td><td align="left"></td><td></td></tr>
<tr><td align="center"><code>_l_</code></td><td align="left">left aligned</td><td align="center"><img src="aql/../images/A-cov-left-B.svg" alt="" /></td><td align="left">Both elements span an area beginning with the same token</td><td></td></tr>
<tr><td align="center"><code>_r_</code></td><td align="left">right aligned</td><td align="center"><img src="aql/../images/A-cov-right-B.svg" alt="" /></td><td align="left">Both elements span an area ending with the same token</td><td></td></tr>
<tr><td align="center"><code>==</code></td><td align="left">value identity</td><td align="center"><strong>A = B</strong></td><td align="left">The value of the annotation or token A is identical to that of B (this operator does not bind, i.e. the nodes must be connected by some other criteria too)</td><td></td></tr>
<tr><td align="center"><code>!=</code></td><td align="left">value difference</td><td align="center"><strong>A ≠ B</strong></td><td align="left">The value of the annotation or token A is different from B (this operator does not bind, i.e. the nodes must be connected by some other criteria too)</td><td></td></tr>
<tr><td align="center"><code>-&gt;LABEL</code></td><td align="left">labeled pointing relation</td><td align="center"><img src="aql/../images/A-point-direct-B.svg" alt="" /></td><td align="left">A labeled, directed relationship between two elements. Annotations can be specified with <code>-&gt;LABEL[annotation=&quot;VALUE&quot;]</code></td><td></td></tr>
<tr><td align="center"><code>-&gt;LABEL *</code></td><td align="left">indirect pointing relation</td><td align="center"><img src="aql/../images/A-point-ind-B.svg" alt="" /></td><td align="left">An indirect labeled relationship between two elements. The length of the chain may be specified with <code>-&gt;LABEL n,m</code> for relation chains of length n to m</td><td></td></tr>
<tr><td align="center"><code>#x:arity=n</code></td><td align="left">arity</td><td align="center"><img src="aql/../images/A-arity.svg" alt="" /></td><td align="left">Specifies the amount of directly dominated children that the searched node has</td><td></td></tr>
<tr><td align="center"><code>_ident_</code></td><td align="left">node identity</td><td align="center"></td><td align="left">True for two attributes that belong to the same node</td><td></td></tr>
</tbody></table>
<h2><a class="header" href="#unsupported-operators" id="unsupported-operators">Unsupported operators</a></h2>
<p>The following operators have been available in the legacy version ANNIS3, but are not yet implemented in the newest ANNIS version.</p>
<table><thead><tr><th align="center">Operator</th><th align="left">Description</th><th align="center">Illustration</th><th align="left">Notes</th></tr></thead><tbody>
<tr><td align="center"><code>_ol_</code> and <code>_or_</code></td><td align="left">Overlap, but only on the left or right side</td><td align="center"></td><td align="left"></td></tr>
<tr><td align="center"><code>&gt;@l</code></td><td align="left">left-most child</td><td align="center"><img src="aql/../images/A-left-B.svg" alt="" /></td><td align="left"></td></tr>
<tr><td align="center"><code>&gt;@r</code></td><td align="left">right-most child</td><td align="center"><img src="aql/../images/A-right-B.svg" alt="" /></td><td align="left"></td></tr>
<tr><td align="center"><code>$</code></td><td align="left">common parent node</td><td align="center"><img src="aql/../images/A-parent-B.svg" alt="" /></td><td align="left"></td></tr>
<tr><td align="center"><code>$*</code></td><td align="left">common ancestor node</td><td align="center"><img src="aql/../images/A-ancestor-B.svg" alt="" /></td><td align="left"></td></tr>
<tr><td align="center"><code>#x:tokenarity=n</code></td><td align="left">tokenarity</td><td align="center"><img src="aql/../images/A-tokenarity.svg" alt="" /></td><td align="left">Specifies the length of the span of tokens covered by the node</td></tr>
<tr><td align="center"><code>#x:root</code></td><td align="left">root</td><td align="center"><img src="aql/../images/A-root.svg" alt="" /></td><td align="left">Specifies that the node is not dominated by any other node within its namespace       <strong>s</strong></td></tr>
</tbody></table>
<h1><a class="header" href="#differences-in-compatibility-mode" id="differences-in-compatibility-mode">Differences in Compatibility Mode</a></h1>
<p>Previous versions of ANNIS might have a slightly different interpretation of the semantics of AQL.
By choosing the compatibility mode in the search options, you can emulate the old behavior.
The compatibility mode (also called &quot;quirks mode&quot;) has the following differences to the standard AQL semantics.</p>
<h2><a class="header" href="#indirect-precedence-is-limited-to-a-maximum-distance-of-50" id="indirect-precedence-is-limited-to-a-maximum-distance-of-50">Indirect Precedence is limited to a maximum distance of 50</a></h2>
<p>Indirect precedence (<code>.*</code>) was limited to a maximum distance of 50 in older versions for performance reasons.
E.g. the query <code>tok .* tok</code> is effectively <code>tok .1,50 tok</code>.
Depending on the text length of the documents, the compatibility mode might return fewer matches than the normal mode.</p>
<h2><a class="header" href="#non-reflexive-operator-is-only-applied-locally" id="non-reflexive-operator-is-only-applied-locally">Non-reflexive operator is only applied locally</a></h2>
<p>The operands of non-reflexive operators must be different.
In standard AQL, a new match can be only included if the new match is different to all other matches.
In contrast, the compatibility mode only enforces direct non-reflexivity.
E.g. in the query</p>
<pre><code>node  &amp; node &amp; node &amp; #1 _o_ #2 &amp; #2 _o_ #3
</code></pre>
<p>the first node must be different from the second node and the second node must be different from the third.
In compatibility mode, it is allowed that <code>#1</code> and <code>#3</code> reference the same match because there is no 
non-reflexive operator directly between them.
You would need to change the query to</p>
<pre><code>node  &amp; node &amp; node &amp; #1 _o_ #2 &amp; #2 _o_ #3 &amp; #1 _o_ #3
</code></pre>
<p>to enforce that these operand are not the same.
The standard mode will not include a match if <code>#1</code> and <code>#3</code> reference the same match per default.
This does not affect the addition of matches if the operator is reflexive.</p>
<h2><a class="header" href="#meta-is-still-allowed" id="meta-is-still-allowed"><code>meta::</code> is still allowed</a></h2>
<p>Meta data constraints have been replaced with the part-of operator <code>@*</code> and will result
in a syntax error for the normal query mode.
In the compatibility mode, <code>meta::</code> is still allowed.</p>
<p>Be aware that meta data constraints like <code>meta::doc=&quot;mydocumentname&quot;</code> are applied to all conjunctions of the disjunction, which is seems counter-intuitive.
E.g the query.</p>
<pre><code>(pos=&quot;NN&quot; | lemma=&quot;be&quot; &amp; meta::age=&quot;20&quot;)
</code></pre>
<p>effectively becomes</p>
<pre><code>(pos=&quot;NN&quot; &amp; meta::age=&quot;20&quot; | lemma=&quot;be&quot; &amp; meta::age=&quot;20&quot;)
</code></pre>
<h1><a class="header" href="#importing-and-configuring-corpora" id="importing-and-configuring-corpora">Importing and Configuring Corpora</a></h1>
<p>Before a corpus can be used in ANNIS, it has to be imported once.
This section describes how you can create corpora for ANNIS from existing
corpora in different formats, how you import it and various corpus-related configuration options.</p>
<h1><a class="header" href="#converting-corpora-for-annis-using-pepper" id="converting-corpora-for-annis-using-pepper">Converting Corpora for ANNIS using Pepper</a></h1>
<p>ANNIS supports two types of formats to import:</p>
<ul>
<li>the legacy <a href="http://korpling.github.io/ANNIS/3.6/developer-guide/annisimportformat.html">relANNIS</a> format based on the previous relational database implementation, and</li>
<li>a new GraphML based native format which can be exported from ANNIS and exchanged with other tools which support GraphML (like e.g. Neo4j). </li>
</ul>
<p>Before a corpus can be imported into ANNIS, it has to be converted into a supported format.
The Pepper converter framework allows users to convert data from various formats including PAULA XML,
EXMARaLDA XML, TigerXML, CoNLL, RSTTool, generic XML and TreeTagger
directly into relANNIS. 
Further formats (including Tiger XML with secondary edges,
mmax2) can be converted first into PAULA XML and then into relANNIS using the
converters found on the ANNIS downloads page.</p>
<p>For complete information on converting corpora with Pepper see:
<a href="http://corpus-tools.org/pepper/">http://corpus-tools.org/pepper/</a></p>
<h1><a class="header" href="#importing-corpora-in-the-relannis-or-graphml-format" id="importing-corpora-in-the-relannis-or-graphml-format">Importing Corpora in the relANNIS or GraphML format</a></h1>
<p>Corpora in the relANNIS or GraphML format can be imported into the ANNIS database. 
For information on converting corpora from other formats into relANNIS, see the
<a href="http://corpus-tools.org/pepper/userGuide.html">Pepper documentation</a>.</p>
<h2><a class="header" href="#importing-a-relannis-or-graphml-corpus-using-the-administration-interface" id="importing-a-relannis-or-graphml-corpus-using-the-administration-interface">Importing a relANNIS or GraphML corpus using the administration interface</a></h2>
<p>When you are logged in as an administrator (automatically in desktop version), you can change to the <a href="import-and-config/../interface/admin-web.html">administration interface</a> and use the “Import Corpus“ tab.
Both the relANNIS and GraphML formats might consist of more than one file.
Instead of uploading each file (uploading a directory is not possible), the corpus files must be compressed as ZIP file before they can be uploaded.
On a server installation, importing a corpus will not interrupt querying other corpora that are already imported.</p>
<h2><a class="header" href="#importing-a-corpus-using-the-command-line" id="importing-a-corpus-using-the-command-line">Importing a corpus using the command line</a></h2>
<p>Per default, the embedded graphANNIS backend will store its corpus data in the <code>~/.annis/v4/</code> folder.
You can download the latest released graphANNIS command line interface for your system (named <code>annis</code>, <code>annis.exe</code> or <code>annis.osx</code>) from the release page of graphANNIS:
<a href="https://github.com/korpling/graphANNIS/releases/latest">https://github.com/korpling/graphANNIS/releases/latest</a>.</p>
<p>The CLI can't access the corpus data folder while the ANNIS service is running.
Therefore, stop the running ANNIS service (e.g. with <code>systemctl stop annis</code> on a server or just closing the ANNIS desktop program) and start the graphANNIS CLI with the corpus data folder.</p>
<pre><code class="language-bash">annis ~/.annis/v4/
</code></pre>
<p>For a list of all available commands see the <a href="https://korpling.github.io/graphANNIS/docs/v1.5/cli.html">graphANNIS documentation</a>.
To import a corpus, just execute the <code>import</code> command followed by a path to the corpus to import, e.g.:</p>
<pre><code>import /home/thomas/korpora/pcc2/
</code></pre>
<p>The import command allows importing GraphML files and ZIP files containing more than one corpus.</p>
<h1><a class="header" href="#configuring-settings-for-a-corpus" id="configuring-settings-for-a-corpus">Configuring Settings for a Corpus</a></h1>
<p>For each imported corpus, there is a sub-folder in the corpus data folder (per default <code>~/.annis/v4/</code>) with the corpus name as folder name.
In addition to the actual annotations, this corpus folder contains a configuration file named <code>corpus-config.toml</code> with all corpus specific configuration.<sup class="footnote-reference"><a href="#old-annis-configs">1</a></sup></p>
<p>The configuration file is in the human-readable and editable <a href="https://toml.io/">TOML format</a> and can be edited in any text editor.
TOML uses so-called <a href="https://toml.io/en/v1.0.0-rc.2#table">tables</a> to specify sub-sections of the configuration.
Inside each table, normal key value pairs like in the Java Properties file format can be used.
E.g. the following configuration file has the tables/sections <code>[context]</code> and <code>[view]</code></p>
<pre><code class="language-toml">[context]
# The default context in the user interface
default = 5
# Available context sizes
sizes = [1, 2, 5, 10]
# Maximal context size in tokens
max = 50

[view]
page_size = 10
</code></pre>
<h2><a class="header" href="#maximal-context-size-context-steps-and-result-page-sizes" id="maximal-context-size-context-steps-and-result-page-sizes">Maximal Context Size, Context Steps and Result Page Sizes</a></h2>
<p>The maximal context size of ±n tokens from each search result (for the KWIC view,
but also for other visualizations) can be set for a corpus using the <code>max</code> key in the <code>[context]</code> table.
To configure which steps are actually shown in the front-end (up to the maximum
allowed) add the key <code>sizes</code> and use an <a href="https://toml.io/en/v1.0.0-rc.2#array">array</a> as value. 
By default, the context steps 1, 2, 5 or 10 tokens are available. 
The default context selected when the corpus is queried, can be set with the <code>default</code> key.</p>
<h2><a class="header" href="#setting-default-context-and-segmentations" id="setting-default-context-and-segmentations">Setting Default Context and Segmentations</a></h2>
<p>In corpora with multiple segmentations, such as historical corpora with conflicting
diplomatic and normalized word form layers, it is possible to choose the default
segmentation for both search context and the KWIC visualization. To set the relevant
segmentations, use the following settings in the <code>corpus-config.toml</code> file.</p>
<pre><code class="language-toml">[context]
# The default segmentation used to generate the context
segmentation=&quot;SEGNAME&quot;

[view]
# The default segmentation to show in the user interface (e.g. the KWIC)
base_text_segmentation=&quot;SEGNAME&quot;
</code></pre>
<p>For more details on segmentations, see the ANNIS Multiple Segmentation Corpora
Guide.</p>
<h2><a class="header" href="#adding-example-queries" id="adding-example-queries">Adding Example Queries</a></h2>
<p>User created example queries are stored in the file <code>corpus-config.toml</code> as an <a href="https://toml.io/en/v1.0.0-rc.2#array-of-tables">array of tables</a>.
Each example query starts with the line <code>[[example_queries]]</code> followed by some key value pairs.</p>
<pre><code class="language-toml">[[example_queries]]
query = &quot;\&quot;statisch\&quot;&quot;
description = &quot;search for the word \&quot;statisch\&quot;&quot;
query_language = &quot;AQL&quot;

[[example_queries]]
query = &quot;/.*lich/&quot;
description = &quot;Search for words ending with \&quot;lich\&quot; (regular expression)&quot;
query_language = &quot;AQL&quot;

[[example_queries]]
query = &quot;\&quot;so\&quot; &amp; \&quot;statisch\&quot; &amp; #1 . #2&quot;
description = &quot;search for the word \&quot;so\&quot; followed by the word \&quot;statisch\&quot;&quot;
query_language = &quot;AQL&quot;
</code></pre>
<div class="footnote-definition" id="old-annis-configs"><sup class="footnote-definition-label">1</sup>
<p>In ANNIS 3 the corpus specific configuration was distributed over several configuration files (e.g. the <code>corpus.properties</code> file) and database tables (like the <code>resolver_vis_map.annis</code> or <code>example_queries.annis</code> files).
When importing an relANNIS corpus, the previous corpus configuration files will be mapped to the new format automatically.</p>
</div>
<h1><a class="header" href="#configuring-visualizations" id="configuring-visualizations">Configuring Visualizations</a></h1>
<p>By default, ANNIS displays all search results in the Key Word in Context (KWIC)
view in the &quot;Query Result&quot; tab, though in some cases you may wish to turn off this
visualization (specifically dialog corpora, see below). Further visualizations, such as
syntax trees or grid views, are displayed by default based on the following namespaces 
(both nodes an edges can have namespaces):</p>
<table><thead><tr><th>Element</th><th>Namespace</th><th>Visualizer</th></tr></thead><tbody>
<tr><td>node</td><td>tiger</td><td>tree visualizer</td></tr>
<tr><td>node</td><td>exmaralda</td><td>grid visualizer</td></tr>
<tr><td>node</td><td>mmax</td><td>grid visualizer</td></tr>
<tr><td>edge</td><td>mmax</td><td>discourse view</td></tr>
</tbody></table>
<p>In these cases the namespaces are usually taken from the source format in which the
corpus was generated, and carried over into relANNIS during the conversion. It is also
possible to use other namespaces, most easily when working with PAULA XML. In
PAULA XML, the namespace is determined by the string prefix before the first period
in the file name / paula_id of each annotation layer (for more information, see the
<a href="http://www.sfb632.uni-potsdam.de/en/paula.html">PAULA XML documentation</a>).
Data converted from EXMARaLDA can also optionally use speaker names as
namespaces. For other formats and namespaces, see the SaltNPepper documentation of
the appropriate format module.</p>
<p>In order to manually determine the visualizer and the display name for each namespace
in each corpus, the <code>corpus-config.toml</code> file for this corpus must be edited. 
For relANNIS corpus, this can be done by editing the relANNIS file <code>resolver_vis_map.annis</code> before import (see <a href="http://korpling.github.io/ANNIS/3.6/user-guide/visualizations.html">the old user guide for instructions</a>).
For GraphML based corpora you can edit the <code>corpus-config.toml</code> data attribute that is added as annotation to the graph.
In both cases, you can edit the <code>corpus-config.toml</code> in the corpus data directory after import.</p>
<p>As with the example queries, visualizer entries are added as table arrays to the configuration file.
Each rule has the table name <code>[[visualizers]]</code>.
The order of the entries in the file also determines the order in the result view.</p>
<pre><code class="language-toml">[[visualizers]]
element = &quot;edge&quot;
layer = &quot;dep&quot;
vis_type = &quot;arch_dependency&quot;
display_name = &quot;dependencies (Stanford)&quot;
visibility = &quot;hidden&quot;

[[visualizers]]
element = &quot;edge&quot;
layer = &quot;ud&quot;
vis_type = &quot;arch_dependency&quot;
display_name = &quot;dependencies (UD)&quot;
visibility = &quot;hidden&quot;

[[visualizers]]
element = &quot;node&quot;
layer = &quot;const&quot;
vis_type = &quot;tree&quot;
display_name = &quot;constituents (tree)&quot;
visibility = &quot;hidden&quot;

[visualizers.mappings]
# These are the mappings for the &quot;constituents (tree)&quot; visualizer entry
edge_anno_ns = &quot;const&quot;
edge_key = &quot;func&quot;
edge_type = &quot;edge&quot;
node_key = &quot;cat&quot;

[[visualizers]]
element = &quot;node&quot;
layer = &quot;ref&quot;
vis_type = &quot;grid&quot;
display_name = &quot;referents (grid)&quot;
visibility = &quot;hidden&quot;

[visualizers.mappings]
# These are the mappings for the &quot;referents (grid)&quot; visualizer entry
annos = &quot;/ref::coref_val/,/ref::entity/,/ref::infstat/&quot;
escape_html = &quot;false&quot;
</code></pre>
<p>The key value pairs for each visualizer rule can be
filled out as follows:</p>
<ul>
<li><em>layer</em> specifies the relevant node or edge layer (also called namespace) which triggers the
visualization</li>
<li><em>element</em> determines if a <code>node</code> or an <code>edge</code> should carry the relevant annotation
for triggering the visualization</li>
<li><em>vis_type</em> determines the visualizer module used, see the <a href="import-and-config/visualizations-list.html">list of visualizations</a> for possible values</li>
<li><em>display_name</em> determines the heading that is shown for each visualizer in the interface</li>
<li><em>visibility</em> is optional and can be set to:
<ul>
<li><em>hidden</em> - the default setting: the visualizer is not shown, but can be
expanded by clicking on its plus symbol.</li>
<li><em>permanent</em> - always shown, not closable</li>
<li><em>visible</em> - shown initially, but closable by clicking on its minus symbol.</li>
<li><em>removed</em> - not shown; this can be used to hide the KWIC visualization in corpora which require a grid by default (e.g. dialogue corpora)</li>
<li><em>preloaded</em> - like hidden, but actually rendered in the background even
before its plus symbol is clicked. This is useful for multimedia player
visualizations, as the player can be invoked and a file may be loaded
before the user prompts the playing action.</li>
</ul>
</li>
<li><em>[visualizers.mappings]</em> provides additional parameters for some visualizations: a <code>[visualizer.mappings]</code> table must be added after the last key value pair of the corresponding <code>[[visualizers]]</code> entry.
Each key corresponds to a visualizer specific parameter names (see the <a href="import-and-config/visualizations-list.html">list of visualizations</a> for parameters for a specific visualizer).</li>
</ul>
<h1><a class="header" href="#list-of-visualizations" id="list-of-visualizations">List of Visualizations</a></h1>
<h2><a class="header" href="#kwic" id="kwic"><code>kwic</code></a></h2>
<p>Default key-word in context view.</p>
<p><img src="import-and-config/vis-kwic.png" alt="kwic visualizer" /></p>
<h2><a class="header" href="#tree" id="tree"><code>tree</code></a></h2>
<p>Constituent syntax tree.</p>
<p><img src="import-and-config/vis-tree.png" alt="tree visualizer" /></p>
<h3><a class="header" href="#mappings" id="mappings">Mappings</a></h3>
<p>The annotation names to be displayed in non terminal nodes can
be set e.g. using <code>node_key = &quot;cat&quot;</code> for an annotation called <em>cat</em> (the default),
and similarly the edge labels using <code>edge_key = &quot;func&quot;</code> for an edge label
called <em>func</em> (the default). 
It is also possible to use a different annotation
layer for the leaves of the tree instead of the default tokens by
specifying <code>terminal_name</code> for the annotation name and <code>terminal_ns</code> for
the namespace. Multiple instructions are separated using semicolons.</p>
<h2><a class="header" href="#grid" id="grid"><code>grid</code></a></h2>
<p>Annotation grid, with annotations spanning multiple tokens.</p>
<p><img src="import-and-config/vis-grid.png" alt="grid visualizer" /></p>
<h3><a class="header" href="#mappings-1" id="mappings-1">Mappings</a></h3>
<p>It is possible to specify the order of annotation layers in each grid.
Use <code>annos = &quot;anno_name1, anno_name2, anno_name3&quot;</code> to specify the
order or annotation layers. If <code>annos</code> is used, additional annotation layers
not present in the list will not be visualized. If mappings is left empty,
layers will be ordered alphabetically. It is also possible to add
annotations applying to the tokens to the visualization, rather than only
span element annotations, by using <code>tok_anno = &quot;true&quot;</code>. Finally, you may
hide the tokens that normally appear at the bottom of the grid using
<code>hide_tok = &quot;true&quot;</code>.</p>
<h2><a class="header" href="#grid_tree" id="grid_tree"><code>grid_tree</code></a></h2>
<p>A grid visualizing hierarchical tree annotations as ordered grid layers.</p>
<p><img src="import-and-config/vis-grid_tree.png" alt="grid_tree visualizer" /></p>
<p><em><strong>Note:</strong></em>  all layers represent the same annotation name at different hierarchical depths, marked level: 0,1,2,... etc. on the left</p>
<h3><a class="header" href="#mappings-2" id="mappings-2">Mappings</a></h3>
<p>Specify the name of the annotation to be visualized in the
grid with <code>node_key = &quot;name&quot;</code>. Note that all grid levels visualize the same
annotation name at different hierarchical depths.</p>
<h2><a class="header" href="#sentstructurejs" id="sentstructurejs"><code>sentstructurejs</code></a></h2>
<p>Visualization for token-token alignments between parallel
texts using <a href="https://gitlab.cl.uzh.ch/sparcling/SentStructure.js">SentStructure.js</a></p>
<p><img src="import-and-config/vis-sentstructurejs.png" alt="sentstructurejs visualizer for parallel corpus alignment" /></p>
<h3><a class="header" href="#mappings-3" id="mappings-3">Mappings</a></h3>
<p>Use <code>alignment_label</code> to specify the edge annotation name that should be displayed.</p>
<h2><a class="header" href="#discourse" id="discourse"><code>discourse</code></a></h2>
<p>A view of the entire text of a document, possibly with interactive coreference links.</p>
<p><img src="import-and-config/vis-discourse.png" alt="discourse visualizer" /></p>
<p>It is possible to use this visualization to view entire texts even if you do not have coreference annotations)</p>
<h2><a class="header" href="#arch_dependency" id="arch_dependency"><code>arch_dependency</code></a></h2>
<p>Dependency tree with labeled arches between tokens;
requires SVG enabled browser.</p>
<p><img src="import-and-config/vis-arch_dependency.png" alt="arch_dependency visualizer" /></p>
<h3><a class="header" href="#mappings-4" id="mappings-4">Mappings</a></h3>
<p>To use a different annotation layer (e.g. <em>my_annotation</em>) for the leaves of the tree instead of the default tokens,
enter <code>node_key = &quot;my_annotation&quot;</code>.</p>
<h2><a class="header" href="#audio" id="audio"><code>audio</code></a></h2>
<p>A linked audio file.</p>
<p><img src="import-and-config/vis-audio.png" alt="audio visualizer" /></p>
<h2><a class="header" href="#video" id="video"><code>video</code></a></h2>
<p>A linked video file.</p>
<p><img src="import-and-config/vis-video.png" alt="video visualizer" /></p>
<h2><a class="header" href="#pdf-or-pdfdoc" id="pdf-or-pdfdoc"><code>pdf</code> or <code>pdfdoc</code></a></h2>
<p>A linked pdf file, showing either a specific page aligned
with an annotation or an entire pdf document respectively.</p>
<p><img src="import-and-config/vis-pdf.png" alt="pdf visualizer" /></p>
<h3><a class="header" href="#mappings-5" id="mappings-5">Mappings</a></h3>
<p>It is possible to configure the height of the pdf window
using the <code>height</code> instruction (in pixels), as well as the name (<code>node_key</code>)
of the node annotation to be used to give individual page numbers
aligned with a span of tokens (relevant for <code>pdf</code> only, <code>pdfdoc</code> always
shows all pages). The instructions can be combined as follows:</p>
<pre><code class="language-toml">[visualizers.mappings]
node_key = &quot;pp&quot;
height = &quot;400&quot;
</code></pre>
<h2><a class="header" href="#rst-or-rstdoc" id="rst-or-rstdoc"><code>rst</code> or <code>rstdoc</code></a></h2>
<p>A visualization for rhetorical structure theory annotations,
of either just the search result with context or the entire document
respectively.</p>
<p><img src="import-and-config/vis-rst.png" alt="rst visualizer" /></p>
<h3><a class="header" href="#mappings-6" id="mappings-6">Mappings</a></h3>
<p>The names of rst edges can be configured with the setting
<code>edge</code>. Additionally, some graphical parameters can be modified:
<code>siblingOffet</code> defines the distance between sibling nodes; <code>subTreeOffset</code>
defines the distance between node and parent node; <code>nodeWidth</code> defines
the width of a node; <code>labelSize</code> defines the font size of a node label;
<code>edgeLabelColor</code> specifies an HTML Color for the font color of an edge
label; <code>nodeLabelColor</code> specifies an HTML Color for the font color of a
node label.</p>
<h2><a class="header" href="#html-or-htmldoc" id="html-or-htmldoc"><code>html</code> or <code>htmldoc</code></a></h2>
<p>A versatile annotation-triggered css-based visualization
of either the immediate search result context or the entire document
respectively; see the ANNIS HTML Visualization Guide for more
details and some example stylesheets.</p>
<p><img src="import-and-config/vis-html.png" alt="html visualizer" /></p>
<h3><a class="header" href="#mappings-7" id="mappings-7">Mappings</a></h3>
<p>You must specify the name of the css stylesheet (<em>.css)
and configuration file (</em>.config) for the visualization, which are place in
the ExtData folder of the relANNIS corpus (see HTML Visualization
Guide for details). To configure the stylesheet name, use the value
<code>config = &quot;filename&quot;</code>, where filename is the common name of both
the .config and the .css files, without the extension.</p>
<h1><a class="header" href="#document-browser" id="document-browser">Document Browser</a></h1>
<p>It is possible to view a list of documents for each corpus and
visualize documents independently of any queries posed by the user. To open the
document browser for a corpus, click on the document icon in the corpus list next to
each corpus. By default, a list as shown below is generated with a link to a plain text
representation of each document.</p>
<p><img src="import-and-config/document-browser.png" alt="document browser" /></p>
<h2><a class="header" href="#custom-visualizer-and-sorting" id="custom-visualizer-and-sorting">Custom visualizer and sorting</a></h2>
<p>It is also possible to use a custom visualizer for browsing a whole
document. The configuration is in <a href="http://www.json.org/">JSON</a>-Syntax file named
<code>document_browser.json</code>, which can be add to the ExtData directory of
each corpus.</p>
<pre><code class="language-json">{
  &quot;visualizers&quot;: [
    {
      &quot;type&quot;: &quot;htmldoc&quot;,
      &quot;displayName&quot;: &quot;diplomatic text&quot;,
      &quot;mappings&quot;: &quot;config:dipl&quot;
    },
    {
      &quot;type&quot;: &quot;rstdoc&quot;,
      &quot;displayName&quot;: &quot;rhetorical structure&quot;
    }
  ],
  &quot;metaDataColumns&quot;: [
    {
      &quot;namespace&quot;: &quot;annis&quot;,
      &quot;name&quot;: &quot;title&quot;
    },
    {
      &quot;namespace&quot;: &quot;annis&quot;,
      &quot;name&quot;: &quot;genre&quot;
    }
  ],
  &quot;orderBy&quot;: [
    {
      &quot;namespace&quot;: &quot;annis&quot;,
      &quot;name&quot;: &quot;title&quot;,
      &quot;ascending&quot;: &quot;false&quot;
    }
  ]
}
</code></pre>
<p>Explanation in detail:</p>
<ul>
<li><em>visualizers - type</em>: Defines which document visualizers are available for a
corpus. All visualizer from the list above with the suffix &quot;doc&quot; in
their name are suitable for using as doc visualizer.</li>
<li><em>metaDataColumns</em> (optional): For every defined metadata field an additional
column is generated in the corpus browser table with the metadata key as a
column header and the metadata value as the table cell value. This is useful for
viewing, and sorting by, different metadata available to the documents. The line
“namespace” can be left out if the namespace is null.</li>
<li><em>orderBy</em> (optional): In the default state the table is sorted by document name.
Alternatively it is possible to define a custom sort by the metadata fields, even
if the column is not visible. &quot;namespace&quot; and &quot;ascending&quot; are optional (if
namespace is not specified, null is assumed). &quot;ascending&quot; is &quot;true&quot; by default.</li>
</ul>
<h1><a class="header" href="#configuration-of-annis" id="configuration-of-annis">Configuration of ANNIS</a></h1>
<p>For the desktop version of ANNIS, you most probably don't need to change any of the default configuration and you can skip this section.
If you are installing ANNIS on a server however, you might want to tweak the settings.
The <a href="http://en.wikipedia.org/w/index.php?title=.properties&amp;oldid=521500688">Java Properties</a>, <a href="https://toml.io/">TOML</a> and <a href="http://www.json.org/">JSON</a> file formats are used for different kind of configuration.</p>
<p>ANNIS uses the Spring Boot configuration system and thus it will search for a Java Properties based configuration file named <code>application.properties</code> in the current working directory or a <code>config</code> sub-directory of the working directory.
You can also use the command line argument <code>--spring.config.location=file:/&lt;location-on-disk&gt;</code> to specify a specific configuration file.
More options are documented in the <a href="https://docs.spring.io/spring-boot/docs/2.3.x/reference/html/spring-boot-features.html#boot-features-external-config-application-property-files">Spring Boot documentation</a>.</p>
<p>The following is an example configuration with ANNIS-specific configuration values.</p>
<pre><code class="language-properties"># The port on which this service is listening
server.port=5712

# Defines from where the user interface service can be accessed from.
# 127.0.0.1 as value will only allow connections from the server itself (localhost)
# The default value 0.0.0.0 allows connections from everywhere.
server.address=127.0.0.1

# A configuration file for the embedded REST Service. 
# See https://korpling.github.io/graphANNIS/docs/v0.30/rest.html 
# for more information on how to configure the graphANNIS service.
annis.webservice-config=${user.home}/.annis/service.toml

# If non-empty this URL is used to communicate with the REST backend service instead of using the embedded service (which will not be started)
# annis.webservice-url=http://localhost:5711/v1

# set to &quot;true&quot; to globally disable right-to-left text detection
annis.disable-rtl=false
# set to an valid e-mail adress in order to enable the &quot;Report a bug&quot; button
annis.bug-e-mail=user@example.com

# If &quot;true&quot;, the user can create reference links with shortened URLs
annis.shorten-reference-links=true

# Path to the persistent database, where e.g. the reference links are stored  
spring.datasource.url=jdbc:h2:file:${user.home}/.annis/v4/frontend_data.h2
</code></pre>
<p>Being a Spring Boot application, ANNIS configuration properties also be directly given as <a href="https://docs.spring.io/spring-boot/docs/2.3.x/reference/html/spring-boot-features.html#boot-features-external-config-command-line-args">command line argument</a>.</p>
<h1><a class="header" href="#user-configuration-on-server" id="user-configuration-on-server">User Configuration on Server</a></h1>
<p>ANNIS has an authorization system based on <a href="https://www.oauth.com/">OAuth2</a> which allows handling multiple users on a server installation using an external identity provider service.
A user will see different corpora depending on which groups the user is part of.
<strong>For the desktop version of ANNIS, a single administrator user is automatically created and logged in.</strong></p>
<p>When using an identity provider, the backend graphANNIS service and the ANNIS frontend needs to be configured to use this service.
Per default, ANNIS uses an embedded graphANNIS service with the configuration located in the home directory of the user running the ANNIS service: <code>~/.annis/service.toml</code>.
See the <a href="https://korpling.github.io/graphANNIS/docs/v0.30/rest/auth.html">graphANNIS documentation on authentication and authorization</a> for how to use this configuration file to configure the backend.
You can choose from various OAuth2 compatible identity providers, but in the following example we will use a self-hosted <a href="https://www.keycloak.org/">Keycloak</a> server.</p>
<h2><a class="header" href="#configure-login-with-a-self-hosted-keycloak-server" id="configure-login-with-a-self-hosted-keycloak-server">Configure Login with a self-hosted Keycloak server</a></h2>
<h3><a class="header" href="#install-and-run-keycloak" id="install-and-run-keycloak">Install and run Keycloak</a></h3>
<p>Follow one of the <a href="https://www.keycloak.org/guides#getting-started">Getting Started</a> guides to install and run the service.
If unsure which one to use, select the <a href="https://www.keycloak.org/getting-started/getting-started-zip">OpenJDK</a> guide.</p>
<h3><a class="header" href="#configure-keycloak-for-annis" id="configure-keycloak-for-annis">Configure Keycloak for ANNIS</a></h3>
<p>Keycloak uses so-called “Realms” to distinguish between different settings.
Download the realm-configuration file for ANNIS from our repository: <a href="https://raw.githubusercontent.com/korpling/ANNIS/main/misc/keycloak-realm-configuration.json">https://raw.githubusercontent.com/korpling/ANNIS/main/misc/keycloak-realm-configuration.json</a>.
We will add a realm for ANNIS by hovering over the realm selection in the top left menu and clicking on “Add realm”.</p>
<p><img src="configuration/add-realm.png" alt="Screenshot of the &quot;Add realm&quot; button in Keycloak realm selection menu" /></p>
<p>Then select this file in “Import”.</p>
<p><img src="configuration/import-realm.png" alt="Screenshot of the empty realm import page" /></p>
<p>The import page will fill out the name of the realm and list other settings under “View details“.
Click on “Create“ to create the realm.</p>
<p><img src="configuration/import-realm-filled-out.png" alt="Screenshot of the filled out realm import page" /></p>
<p>In the realm settings, click on “Keys“ and select “Public Key“</p>
<p><img src="configuration/realm-keys.png" alt="Screenshot of the key overview page for the realm" /></p>
<p>The displayed text is a public key that the graphANNIS REST service needs to verify a user presents a valid authorization token.
Add the following the Keycloak public to your <code>~/.annis/service.toml</code> file (if it does not exist yet, create it):</p>
<pre><code class="language-toml">[auth.token_verification]
type = &quot;RS256&quot;
public_key = &quot;&quot;&quot;
-----BEGIN PUBLIC KEY-----
&lt;insert copied public key from Keycloak here&gt;
-----END PUBLIC KEY-----
&quot;&quot;&quot;
</code></pre>
<p>Now create a first administrator user by selecting “Mange -&gt; Users“ in the main Keycloak menu and clicking on the “Add user“ button on the right.</p>
<p><img src="configuration/add-user-button.png" alt="Screenshot of the user overview page for the realm" /></p>
<p>Fill out the user information and click on “Create“.</p>
<p><img src="configuration/filled-out-user.png" alt="Screenshot of the initial user configuration" /></p>
<p>After creating the user, switch to the “Credentials“ tab and set a new password.
Make sure to <strong>unselect</strong> the “Temporary“ switch.</p>
<p><img src="configuration/set-password.png" alt="Screenshot how the credentials tab with a filled out password" /></p>
<p>Then add the <code>admin</code> role to this user by switching to the “Role Mappings“ tab, selecting <code>admin</code> under “Available roles“ and click on “Add selected“.</p>
<p><img src="configuration/add-role.png" alt="Screenshot the role mappings tab" /></p>
<p>The Keycloak server needs to know which URIs are valid client URIs. Go to “Configure -&gt; Clients“, select the “annis” client and replace the <code>http://localhost:5712</code> part of the “Valid Redirect URIs“ with the public URI of the ANNIS frontend.</p>
<p><img src="configuration/replace-redirect-uri.png" alt="Screenshot the valid redirection URI setting" /></p>
<h3><a class="header" href="#configure-the-annis-frontend-service" id="configure-the-annis-frontend-service">Configure the ANNIS frontend service</a></h3>
<p>Edit the application property file (e.g. <code>application.properties</code> in the working directory).</p>
<p>Add the following lines to configure ANNIS to use the Keycloak server:</p>
<pre><code class="language-properties">spring.security.oauth2.client.registration.keycloak.client-id=annis
spring.security.oauth2.client.registration.keycloak.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.keycloak.redirect-uri=http://localhost:5712/login/oauth2/code/keycloak
spring.security.oauth2.client.provider.keycloak.authorization-uri=http://localhost:8080/realms/ANNIS/protocol/openid-connect/auth
spring.security.oauth2.client.provider.keycloak.token-uri=http://localhost:8080/realms/ANNIS/protocol/openid-connect/token
spring.security.oauth2.client.provider.keycloak.user-info-uri=http://localhost:8080/realms/ANNIS/protocol/openid-connect/userinfo
spring.security.oauth2.client.provider.keycloak.user-name-attribute=preferred_username
</code></pre>
<p>Replace the <code>http://localhost:5712/</code> in the <code>redirect-uri</code> parameter with the
public URL of your ANNIS service. Also replace the <code>http://localhost:8080/</code> part
of the <code>authorization-uri</code>, <code>token-uri</code> and <code>user-info</code> parameters with the
public URL of your Keycloak server (if you are testing this on your local
computer, you can leave the values as they are).</p>
<p>ANNIS uses the Spring Security framework for OAuth2 internally.
An overview of the configuration parameters is part of the <a href="https://docs.spring.io/spring-boot/docs/2.3.x/reference/html/spring-boot-features.html#boot-features-security-oauth2">Spring documentation</a>.</p>
<h3><a class="header" href="#start-the-annis-service-and-test-the-login" id="start-the-annis-service-and-test-the-login">Start the ANNIS service and test the login</a></h3>
<p>When you start the ANNIS service and open it in the browser, you should now see a “Login“ button.
Click on it and enter the credentials of the previously created adminstrator user.</p>
<p>Logging in should enable the “Administration“ interface, which you can use to assign groups to corpora.
The imported realm already has the <code>internal</code> group which you can assign to users that e.g. should have access to internal corpora.
You can create new groups and users in the Keycloak interface, assign users to groups and assign corpora to groups in the ANNIS interface.</p>
<h3><a class="header" href="#integrating-third-party-identity-providers" id="integrating-third-party-identity-providers">Integrating third party identity providers</a></h3>
<p>Keycloak also supports integrating third party identity providers like e.g. GitHub or Google.
You can manage them in the “Identity Providers“ menu in Keycloak.
The “User Federation“ menu allows to add LDAP servers which can be used as source for user accounts.</p>
<h1><a class="header" href="#multiple-instances-of-the-interface" id="multiple-instances-of-the-interface">Multiple Instances of the Interface</a></h1>
<h2><a class="header" href="#creating-instances" id="creating-instances">Creating instances</a></h2>
<p>When multiple corpora from different sources are hosted on one server it is often
still desired to group the corpora by their origin and present them differently.
You should not be forced to have an ANNIS frontend and service installation for
each of this groups. Instead the administrator can define so called instances.</p>
<p>An instance is defined by a JSON file inside the instances sub-folder in one of
the <em>configuration locations</em>, e.g. the home folder of the user running the ANNIS service
(under Windows, in <code>C:\Users\username\.annis</code> , or under Mac OSX under <code>/Users/username/.annis/</code>,
which is a hidden folder; to view hidden folders you may need to reconfigure your
Finder application).</p>
<p>Instances can then be specified under this folder.
The name of the file also defines the instance name.
Thus the file <code>instances/falko.json</code> defines the instance named &quot;falko&quot;.</p>
<pre><code class="language-json">{
	&quot;display-name&quot;: &quot;Falko&quot;,
	&quot;default-querybuilder&quot;: &quot;tigersearch&quot;,
	&quot;default-corpusset&quot;: &quot;falko-essays&quot;,
	&quot;corpus-sets&quot;: [
	{
		&quot;name&quot;: &quot;falko-essays&quot;,
		&quot;corpus&quot;: [
		&quot;falko-essay-l1&quot;,
		&quot;falko-essay-l2&quot;
		]
	},
	{
		&quot;name&quot;: &quot;falko-summaries&quot;,
		&quot;corpus&quot;: [
		&quot;falko-summary-l1&quot;,
		&quot;falko-summary-l2&quot;
		]
	}
	],
	&quot;keyboard-layout&quot; : &quot;de&quot;,
	&quot;login-on-start&quot;: &quot;true&quot;,
	&quot;help-url&quot;: &quot;https://example.com/annis-help&quot;
}
</code></pre>
<p>Each instance configuration can have a verbose display-name which is
displayed in the title of the browser window. <code>default-querybuilder</code> defines the
short name of the query builder you want to use. Currently only &quot;tigersearch&quot; and &quot;flatquerybuilder&quot; are
available in the default installation.
The <code>keyboard-layout</code> variable is used as the default value for the virtual keyboard of the AQL query box.
If <code>login-on-start</code> is set to <code>true</code> a login window is shown at each startup of the ANNIS search UI if the user is not logged in yet.
<code>help-url</code> allows to set your own help page which is displayed in the &quot;Help&quot; tab.
<em>This URL must point to the same domain as the ANNIS user interface is located on</em>, because of the same-origin policies of the browsers.</p>
<p>While any user can group corpora into corpus sets for their own, you can define
corpus sets for the whole instance. Each corpus set is an JSON-object with a
name and a list of corpora that belong to the corpus set.</p>
<p>Any defined instance is assigned a special URL at which it can be accessed:
<code>http://&lt;server&gt;/annis-gui/&lt;instance-name&gt;</code>. The default instance is
additionally accessible by not specifying any instance name in the URL. You can
configure your web server (e.g. Apache) to rewrite the URLs if you need a more
project specific and less &quot;technical&quot; URL (e.g. <code>http://&lt;server&gt;/falko</code>).</p>
<h2><a class="header" href="#embedding-web-fonts" id="embedding-web-fonts">Embedding Web Fonts</a></h2>
<p>It is also possible to set an embedded font for query result display in your instance,
using the same JSON instance file file described in the previous section.
Thus a web font is applied to a specific instance. 
If you not want to define an extra instance, it is possible to add the font configuration to the
<code>default.json</code> file in the <em>instance</em> directory. If no <em>instance</em>
directory or <code>default.json</code> file exists, create it. 
Add a property <strong>font</strong> to the config with the following parameters:</p>
<pre><code class="language-json">{
 ...

 &quot;font&quot; :
 {
   &quot;name&quot; : &quot;foo&quot;,
   &quot;url&quot;: &quot;https://example.com/foo.css&quot;,
   &quot;size&quot;: &quot;12pt&quot; // optional
 }
}
</code></pre>
<p>You must also provide a css file, which contains the <code>@font-face</code> rule
und is reachable under the defined link in the instance config:</p>
<pre><code class="language-css">@font-face {
  font-family: 'bar';
  font-style: normal;
  font-weight: normal;
  font-size: larger;
  src:
	local('bar'),
	url(bar.woff) format('woff');
}
</code></pre>
<p>Further explantation about the <code>@font-face</code> rule is available on the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face">MDN web docs
</a>.</p>
<p>If you need to have a different font configuration for the frequency chart
just add a <code>frequency-font</code> entry. It has the same structure as <code>font</code>.</p>
<h2><a class="header" href="#using-corpus-groups" id="using-corpus-groups">Using Corpus Groups</a></h2>
<p>It is possible to group corpora into groups, which are selected above the corpus list in
the search form:</p>
<p><img src="configuration/corpus-group.png" alt="corpus group selection" /></p>
<p>While any user can group corpora into corpus sets for their own use, you can define
corpus sets for the whole instance using the &quot;corpus-sets&quot; in the JSON file described
above. Each corpus set is itself a JSON-object with a name and a list of corpora that
belong to the corpus set.</p>
<h1><a class="header" href="#right-to-left-visualizations" id="right-to-left-visualizations">Right-to-Left Visualizations</a></h1>
<p>The KWIC, grid and tree visualizers support right to left layouting of Arabic and
Hebrew characters. As soon as such a character is recognized in a search result, the
visualization is switched into right-to-left mode for these visualizers. If this behavior is
not desired (e.g. a left-to-right corpus with only a few incidental uses of such
characters), this behavior can be switched off for the entire ANNIS instance by setting:</p>
<pre><code>annis.disable-rtl=true
</code></pre>
<p>in the file <code>application.properties</code> in one of the configuration locations.</p>
<h1><a class="header" href="#advanced-topics" id="advanced-topics">Advanced Topics</a></h1>
<p>This section provides guides for advanced configuration and administration topics.</p>
<h1><a class="header" href="#links-to-queries" id="links-to-queries">Links to queries</a></h1>
<p>If you have an external application that wants to link to a specific corpus or query in ANNIS, you can
built a special URL that will trigger the query execution. The main part of the URL is the complete host and path to your ANNIS installation e.g. <code>https://korpling.german.hu-berlin.de/annis3/</code>.</p>
<p>In order to execute a query, you have to append a fragment (separated with a &quot;#&quot;) containing a set of parameters. Each parameter consists of a name, the &quot;=&quot; character and its value. These parameters are again separated by &quot;&amp;&quot;, e.g. <code>https://korpling.german.hu-berlin.de/annis3/#q=tok&amp;c=pcc2</code>. The parameters can be optionally encoded in Base64 in order to avoid any clashes with the special characters used in the fragment. A Base64 encoded parameter always starts with an underscore (&quot;_&quot;). E.g. if you want to specifiy the &quot;q&quot; parameter in Base64 encoding you name this parameter &quot;_q&quot;.</p>
<h2><a class="header" href="#available-parameters" id="available-parameters">Available parameters</a></h2>
<table><thead><tr><th>Name</th><th>Explanation</th></tr></thead><tbody>
<tr><td>c</td><td>A comma seperated list of corpora. If this is the only parameter instead of executing a query, the corpus will be only selected. When you use Base64 encoding the commata must be encoded as well.</td></tr>
<tr><td>q</td><td>The AQL query to use.</td></tr>
<tr><td>l</td><td>Limits the query to a number of matches (must be a number). <em>If not specified no limit is applied!</em></td></tr>
<tr><td>s</td><td>Offset (&quot;start&quot;) for the shown matches (must be a number). Defaults to &quot;0&quot;, so the very first matches are shown.</td></tr>
<tr><td>cl</td><td>Optional left context (must be a number).</td></tr>
<tr><td>cr</td><td>Optional right context (must be a number).</td></tr>
<tr><td>seg</td><td>Optional parameter to specify the segmentation on which the context should be applied.</td></tr>
</tbody></table>
<h1><a class="header" href="#embed-annis-visualizations" id="embed-annis-visualizations">Embed ANNIS visualizations</a></h1>
<p>It is possible to embed visualizations of ANNIS into another website or
to share links to ANNIS visualizations.
This is achieved by a special sub website of ANNIS which has the URL</p>
<pre><code>&lt;annis-base-url&gt;/embeddedvis/&lt;visualizer-short-name&gt;
</code></pre>
<p>The possible values for the short name are the same as the ones listed in the <a href="advanced/../import-and-config/visualizations-list.html">&quot;List of Visualizations&quot; chapter</a> chapter.
Additional parameters are used to configure how the visualization should be displayed.</p>
<h2><a class="header" href="#parameters" id="parameters">Parameters</a></h2>
<p>These are URL query parameters which define the visualizer configuration.
Any parameter which is not mentioned here will be treated as visualizer mapping.</p>
<h3><a class="header" href="#embedded_interface" id="embedded_interface">embedded_interface</a></h3>
<p>URL back to the ANNIS instance from which this visualization was generated.
When given this will trigger a link to appear in the output which links back to this URL.
The URL should contain all the information (e.g. via fragment parameters) to display
the query and the selected match.</p>
<h3><a class="header" href="#embedded_match" id="embedded_match">embedded_match</a></h3>
<p>A plain text match definition (as produced by the REST find-function <code>annis.service.QueryService#find(...)</code>).
Example:</p>
<pre><code>salt:/pcc2/11299/#tok_1 tiger::pos::salt:/pcc2/11299/#tok_2
</code></pre>
<h3><a class="header" href="#embedded_instance" id="embedded_instance">embedded_instance</a></h3>
<p>Name of an ANNIS sub-instance that should be used.
See the <a href="advanced/../configuration/instances.html">&quot;Multiple Instances of the Interface&quot; chapter</a> for more information.</p>
<h3><a class="header" href="#embedded_ns" id="embedded_ns">embedded_ns</a></h3>
<p>Namespace which is &quot;triggering&quot; the visualization (see the <a href="advanced/../visualizations">&quot;Configuring Visualizations&quot; chapter</a>)</p>
<h3><a class="header" href="#embedded_base" id="embedded_base">embedded_base</a></h3>
<p>Segmentation base text to use.
Some visualizers like <code>kwic</code> allow to show only a certain base text,
this parameter controls which one.</p>
<h2><a class="header" href="#examples" id="examples">Examples</a></h2>
<p>In this example https://korpling.german.hu-berlin.de/annis3-snapshot/ is the base URL for the ANNIS user interface.
When entering the URL</p>
<pre><code>https://korpling.german.hu-berlin.de/annis3-snapshot/embeddedvis/grid?
embedded_ns=tei&amp;
embedded_instance=&amp;
embedded_salt=http%3A%2F%2Flocalhost%3A5713%2Fannis%2Fquery%2Fsearch%2Fsubgraph%3Fmatch%3Dtei%3A%3Asic%3A%3Asalt%3A%2FGUM%2FGUM_whow_languages%2F%2523sic_487%26left%3D5%26right%3D5&amp;
embedded_interface=https://korpling.german.hu-berlin.de/annis3-snapshot/%23_q%3Dc2lj%26_c%3DR1VN%26cl%3D5%26cr%3D5%26s%3D10%26l%3D10%26m%3D12
</code></pre>
<p>the following web page is <a href="https://korpling.german.hu-berlin.de/annis3-snapshot/embeddedvis/grid?embedded_ns=tei&amp;embedded_instance=&amp;embedded_salt=http%3A%2F%2Flocalhost%3A5713%2Fannis%2Fquery%2Fsearch%2Fsubgraph%3Fmatch%3Dtei%3A%3Asic%3A%3Asalt%3A%2FGUM%2FGUM_whow_languages%2F%2523sic_487%26left%3D5%26right%3D5&amp;embedded_interface=https://korpling.german.hu-berlin.de/annis3-snapshot/%23_q%3Dc2lj%26_c%3DR1VN%26cl%3D5%26cr%3D5%26s%3D10%26l%3D10%26m%3D12">shown</a>:
<img src="advanced/embed_example1.png" alt="Embed example 1" /></p>
<p>The namespace is &quot;tei&quot;, the instance is the default one (empty name).
There is a dynamic URL to the REST web service running at <code>localhost</code> (the service must be reachable by the web server, not the client)
and a back-link to the interface is given.
All parameters must be URL encoded (especially the ones that are URLs by theirself).</p>
<p>Instead of having only a subgraph with for a single match the following example shows a <a href="https://korpling.german.hu-berlin.de/annis3-snapshot/embeddedvis/htmldoc?embedded_instance=scriptorium2&amp;embedded_match=Abraham::norm::salt:/abraham.our.father/Abraham.XL93-94_merge/%23norm_15&amp;embedded_salt=http%3A%2F%2Flocalhost%3A5713%2Fannis%2Fquery%2Fgraph%2Fabraham.our.father%2FAbraham.XL93-94_merge%3Ffilternodeanno%3Dcb%2CAbraham%3A%3Anorm%2Cpb_xml_id%2Clb%2Chi_rend&amp;embedded_interface=https://korpling.german.hu-berlin.de/annis3-snapshot/scriptorium2%23_q%3Dbm9ybT0i4rKb4rKf4rKp4rKn4rKJIg%26_c%3DYWJyYWhhbS5vdXIuZmF0aGVy%26cl%3D5%26cr%3D5%26s%3D0%26l%3D10%26_seg%3Dd29yZA%26m%3D0&amp;embedded_base=word&amp;config=dipl">complete document</a>:</p>
<pre><code>https://korpling.german.hu-berlin.de/annis3-snapshot/embeddedvis/htmldoc?
embedded_instance=scriptorium2&amp;
embedded_match=Abraham::norm::salt:/abraham.our.father/Abraham.XL93-94_merge/%23norm_15&amp;
embedded_salt=http%3A%2F%2Flocalhost%3A5713%2Fannis%2Fquery%2Fgraph%2Fabraham.our.father%2FAbraham.XL93-94_merge%3Ffilternodeanno%3Dcb%2CAbraham%3A%3Anorm%2Cpb_xml_id%2Clb%2Chi_rend&amp;
embedded_interface=https://korpling.german.hu-berlin.de/annis3-snapshot/scriptorium2%23_q%3Dbm9ybT0i4rKb4rKf4rKp4rKn4rKJIg%26_c%3DYWJyYWhhbS5vdXIuZmF0aGVy%26cl%3D5%26cr%3D5%26s%3D0%26l%3D10%26_seg%3Dd29yZA%26m%3D0&amp;
embedded_base=word&amp;
config=dipl
</code></pre>
<p><code>embedded_salt</code> refers to the graph function <code>annis.service.QueryService.graph(...)</code> and this example uses the configuration from the &quot;scriptorium2&quot; instance.
The additional parameter <code>config</code> is a mapping parameter of the <code>htmldoc</code> visualizer.
<img src="advanced/embed_example2.png" alt="Embed example 2" /></p>
<h1><a class="header" href="#install-backend-and-front-end-on-different-servers" id="install-backend-and-front-end-on-different-servers">Install backend and front-end on different servers</a></h1>
<p>It is possible to install the service and the front-end on different servers.
Per-default the ANNIS REST service is only listening to connections from localhost for security reasons.
You should use a proxy server if you want to enable access from outside.
E.g. the Apache configuration could look like this:</p>
<pre><code class="language-Apache">ProxyPass /annis3-service http://localhost:5711
&lt;location /annis3-service&gt;
 SSLRequireSSL
&lt;/location&gt;
</code></pre>
<p>If you your server is <code>example.com</code> this configuration would result in the service URL <code>https://example.com/annis3-service/v1/</code></p>
<p>The service is responsible for the authentication and authorization (see <a href="advanced/../configuration/user.html">the user configuration</a> for more information), thus the corpora are only accessible by the 
service if the user can provide the appropriate credentials.
User names and passwords will be sent as clear text over the network.
<strong>Thus you should always make sure to enforce encrypted SSL (HTTPS) connections for the public accessible service.</strong></p>
<p>After you made the service available for other servers you have to configure the front-end to use this non-default service URL.
Change the file <code>application.properties</code> and set the <code>annis.webservice-url</code> to the right value:</p>
<pre><code class="language-properties">annis.webservice-url=https://example.com/annis3-service/v1
</code></pre>
<p>If you want to secure your service even further you might want to setup a firewall in a way that only the server running the front-end is allowed to access the HTTP(S) port on the server running the backend service.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
